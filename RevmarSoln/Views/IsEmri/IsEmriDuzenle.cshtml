@using SahinRektefiyeSoln.Models.HelperModels;
@model SahinRektefiyeSoln.Models.ViewModels.IsEmri.IsEmriDuzenlePageModel
@{

	string plaka = string.Empty;
	plaka = Model.isEmri.Arac != null ? Model.isEmri.Arac.Plaka : "";


	ViewBag.Title = "IsEmriDuzenle-" + plaka;
	Layout = "~/Views/Shared/_Layout.cshtml";
	string MusteriDesc = string.Empty;
	string MusteriDesc2 = string.Empty;
	string FaturalanacakMusteri = string.Empty;

	if (Model.isEmri.Musteri3 != null)
	{
		FaturalanacakMusteri = Model.isEmri.Musteri3.MusteriTipi == "B" ? (Model.isEmri.Musteri3.TCKN + "-" + Model.isEmri.Musteri3.MusteriAdi.ToString() + " " + Model.isEmri.Musteri3.MusteriSoyadi.ToString()) : (Model.isEmri.Musteri3.VergiNo + "-" + Model.isEmri.Musteri3.KurumAdi.ToString());
	}
	else {
		FaturalanacakMusteri = Model.isEmri.Musteri.MusteriTipi == "B" ? (Model.isEmri.Musteri.TCKN + "-" + Model.isEmri.Musteri.MusteriAdi.ToString() + " " + Model.isEmri.Musteri.MusteriSoyadi.ToString()) : (Model.isEmri.Musteri.VergiNo + "-" + Model.isEmri.Musteri.KurumAdi.ToString());
	}

	MusteriDesc2 = Model.isEmri.Musteri.MusteriTipi == "B" ? (Model.isEmri.Musteri.TCKN + "-" + Model.isEmri.Musteri.MusteriAdi.ToString() + " " + Model.isEmri.Musteri.MusteriSoyadi.ToString()) : (Model.isEmri.Musteri.VergiNo + "-" + Model.isEmri.Musteri.KurumAdi.ToString());

	if (Model.isEmri.Musteri != null)
	{
		MusteriDesc = Model.isEmri.Musteri.MusteriTipi == "B" ? (Model.isEmri.Musteri.MusteriAdi.ToString() + " " + Model.isEmri.Musteri.MusteriSoyadi.ToString()) : Model.isEmri.Musteri.KurumAdi.ToString();
	}

	int kalemCounter = 1;

	bool SwSms = false;
	bool SwArama = false;
	bool SwMail = false;

	if (Model.isEmri.Musteri.MusteriTelefon != null)
	{
		SwSms = Model.isEmri.Musteri.MusteriTelefon.Where(x => x.SwOnaySms == true).Count() > 0 ? true : false;
		SwArama = Model.isEmri.Musteri.MusteriTelefon.Where(x => x.SwOnayArama == true).Count() > 0 ? true : false;
	}

	if (Model.isEmri.Musteri.MusteriMail != null)
	{
		SwMail = Model.isEmri.Musteri.MusteriMail.Where(x => x.SwOnay == true).Count() > 0 ? true : false;
	}

	var aracTeslimLog = Model.isEmri.IsEmriAracTeslimLog.OrderByDescending(x => x.IsEmriAracTeslimLogId).Take(1);

	if (!aracTeslimLog.Any())
	{
		Model.SwAracInService = false;
	}
	else
	{
		Model.SwAracInService = aracTeslimLog.First().SwAracInService;
	}

	bool KonsinyeVarmi = false;
	foreach (var item in Model.isEmriKalemleri.Where(x => x.KalepTipi == "P"))
	{
		if (item.IsKonsinye)
		{
			KonsinyeVarmi = true;
		}
	}

	int musteriIstekCount = 1;

	int IsEmriStatuId = Model.isEmri.IsEmriStatuId;

	List<int> isEmriGunlukIds = SahinRektefiyeSoln.Models.Parameters.ServiceIsEmriIds();


}
<link href="~/Styles/jquery-ui.css" rel="stylesheet" />
<script src="~/Scripts/jquery-ui.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.2/css/buttons.dataTables.min.css" />
<script src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>
<style>
	table {
		font-size: 1em;
	}

	.ui-draggable, .ui-droppable {
		background-position: top;
	}
</style>

<script>
	$(document).ready(function () {

		$.widget("custom.combobox", {
			_create: function () {
				this.wrapper = $("<span>")
					//.addClass("custom-combobox")
					.css({ 'position': 'relative' })
					.css({ 'width': "auto!important" })
					.insertAfter(this.element);

				this.element.hide();
				this._createAutocomplete();
				this._createShowAllButton();
			},

			_createAutocomplete: function () {
				var selected = this.element.children(":selected"),
					value = selected.val() ? selected.text() : "";

				this.input = $("<input>")
					.appendTo(this.wrapper)
					.val(value)
					.attr("title", "")
					//.addClass("custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left")
					.addClass("w3-select w3-border w3-round w3-padding")
					.autocomplete({
						delay: 0,
						minLength: 0,
						source: $.proxy(this, "_source")
					})
					.tooltip({
						classes: {
							"ui-tooltip": "ui-state-highlight"
						}
					});

				this._on(this.input, {
					autocompleteselect: function (event, ui) {
						ui.item.option.selected = true;
						this._trigger("select", event, {
							item: ui.item.option
						});
					},

					autocompletechange: "_removeIfInvalid"
				});
			},

			_createShowAllButton: function () {
				var input = this.input,
					wasOpen = false;

				$("<a>")
					.attr("tabIndex", -1)
					.attr("title", "Tümünü Göster")
					.tooltip()
					.appendTo(this.wrapper)
					.button({
						icons: {
							primary: "ui-icon-triangle-1-s"
						},
						text: false
					})
					.css('margin-right', 3)
					.removeClass("ui-button ui-corner-all ui-widget ui-button-icon-only ")
					//.addClass("custom-combobox-toggle ui-corner-right")
					.addClass("w3-display-right")
					.on("mousedown", function () {
						wasOpen = input.autocomplete("widget").is(":visible");
					})
					.on("click", function () {
						input.trigger("focus");

						// Close if already visible
						if (wasOpen) {
							return;
						}

						// Pass empty string as value to search for, displaying all results
						input.autocomplete("search", "");
					});
			},

			_source: function (request, response) {
				var matcher = new RegExp($.ui.autocomplete.escapeRegex(request.term), "i");
				var i = 0;
				response(this.element.children("option").map(function () {
					var text = $(this).text();
					if (this.value && (!request.term || matcher.test(text))) {
						i += 1;
						if (i <= 5) {
							return {
								label: text,
								value: text,
								option: this
							};
						}

					}

				}));
			},

			_removeIfInvalid: function (event, ui) {

				// Selected an item, nothing to do
				if (ui.item) {
					return;
				}

				// Search for a match (case-insensitive)
				var value = this.input.val(),
					valueLowerCase = value.toLowerCase(),
					valid = false;
				this.element.children("option").each(function () {
					if ($(this).text().toLowerCase() === valueLowerCase) {
						this.selected = valid = true;
						return false;
					}
				});

				// Found a match, nothing to do
				if (valid) {
					return;
				}

				// Remove invalid value
				this.input
					.val("")
					.attr("title", value + " seçilmedi.")
					.tooltip("open");
				this.element.val("");
				this._delay(function () {
					this.input.tooltip("close").attr("title", "");
				}, 2500);
				this.input.autocomplete("instance").term = "";
			},

			_destroy: function () {
				this.wrapper.remove();
				this.element.show();
			}
		});

		$("#FaturalanacakMusteriId").combobox({
			select: function (event, ui) {

				$('#FaturalanacakMusteriId').val(ui.item.value);
				$('#FaturalanacakMusteriId').trigger("change");
			}
		});

		var KdvHaricTutar = '@(Model.isEmriKalemleri.Sum(x => x.KdvHaricTutar))';

		function htmlencode(str) {
			var div = document.createElement('div');
			div.appendChild(document.createTextNode(str));
			return div.innerHTML;
		}

		var MusteriId = '@Model.isEmri.Musteri.MusteriId';
		var MusteriDesc = '@FaturalanacakMusteri';
		console.log(MusteriDesc);
		$('#FaturalanacakMusteriId').val(MusteriId);
		console.log(htmlencode(MusteriDesc));
		$('.ui-autocomplete-input').focus().val(MusteriDesc);
		$('.ui-autocomplete-input').autocomplete('close');



		var isEmriStatu = @IsEmriStatuId;

		$('#OrderFaturaTipi').val(@Model.isEmri.FaturaTipi);
		$('#MuhasebeNotu').val('@(Model.isEmri.MuhasebeNotu != null ? SahinRektefiyeSoln.Helpers.RevmerHelper.TurkishCharacterToEnglish(Model.isEmri.MuhasebeNotu).Replace("\n", "").Replace("\r", " ") : "")');


		if (isEmriStatu != @SahinRektefiyeSoln.Models.Parameters.IsEmriAcikStatu || @(ViewBag.IsReadOnly.ToString().ToLower()) || @Model.isEmri.SwBedelsizOnay.ToString().ToLower()) //İptal ise tüm sayfayı disable aç
		{
			$('#txtMusteriIstek').attr('disabled','disabled');
			$('#btnMusteriIstekEkle').attr('disabled','disabled');
			$('#fileInputhdn').attr('disabled','disabled');
			$('#btnDosyaEkle').attr('disabled','disabled');
			$('#btnIsEmriIscilikEkle').attr('disabled', 'disabled');
			$('#btnDyiEkle').attr('disabled', 'disabled');
			$('#btnIsEmriParcaEkle').attr('disabled','disabled');
			$('#btnIsEmriParcaEkleNew').attr('disabled','disabled');
			$('#btnIskontoEkle').attr('disabled','disabled');
			$('#btnIsEmriPaketEkle').attr('disabled','disabled');
			$('#btnSecimleriSil').attr('disabled','disabled');
			$('#btnParcalariTeslimEt').attr('disabled', 'disabled');
			$('#btnIsEmriIptalEt').addClass('w3-disabled');
			$('#btnIsEmriniMuhasebeyeGonder').addClass('w3-disabled');
			$('#BedelsizOnayAciklamasi').addClass('w3-disabled');

			$('.btnTespitler').attr('disabled', 'disabled');
			$('.btnIscilikWithBelirtiKodu').attr('disabled', 'disabled');
			$('.btnDyiEkleWithBelirtiKodu').attr('disabled', 'disabled');
			$('.btnIsEmriParcaEkleWithBelirtiKodu').attr('disabled', 'disabled');
			$('.btnIskontoEkleWithBelirtiKodu').attr('disabled', 'disabled');
			$('.btnIsEmriPaketEkleWihtBelirtiKodu').attr('disabled', 'disabled');
			$('.btnSecimleriSil').attr('disabled', 'disabled');

			$('.aisEmriIptalLine').addClass('w3-disabled');
		}

		$('.aracDosyasi').click(function (e) {
			console.log(this);

			$('#viewImage').attr("src", this.src);

			document.getElementById('modal01').style.display = 'block';
		});

		$("#fileInput").click(function () {
			$("#fileInputhdn").click();
		});

		$('#fileInputhdn').change(function (event) {
			$('#txtpath').val(event.target.files[0].name);
			readURL(this);
		});

		$('#btnClear').click(function () {
			$('#fileInputhdn').val('');
			$('#blah').attr('src', '');
			$('#btnClear').removeClass('w3-show').addClass('w3-hide');
			$('#txtpath').val('');
			$('.image-upload-wrap').show();
			$("#WorkOrderImagesList").empty();
		});

		$('#btnIsEmriIscilikEkle').click(function () {

			$('#divIsEmriIscilikEkle').load('@Url.Action("IsEmriIscilikEkle", "IsEmri", new { IsEmriId  = Model.isEmri.IsEmriId})');

			document.getElementById('ModalIscilikEkle').style.display = 'block';

			return false;

		});

		$('.btnIscilikWithBelirtiKodu').click(function () {

			var BelirtiKodu = $(this).attr("BelirtiKodu");

			$('#divIsEmriIscilikEkle').load('/IsEmri/IsEmriIscilikEkle?IsEmriId=@Model.isEmri.IsEmriId&BelirtiKodu=' + BelirtiKodu );

			document.getElementById('ModalIscilikEkle').style.display = 'block';

			return false;

		});

		$('#btnVehicleHistory').click(function () {

			$('#divVehicleHistory').load('@Url.Action("VehicleHistory", "IsEmri", new { AracId = Model.isEmri.AracId})');

			document.getElementById('ModalVehicleHistory').style.display = 'block';

			return false;

		});

		$('#btnDyiEkle').click(function () {

			$('#divDyiEkle').load('@Url.Action("IsEmriDyiEkle", "IsEmri", new { IsEmriId  = Model.isEmri.IsEmriId})');


			document.getElementById('ModalDyiEkle').style.display = 'block';

			return false;

		});

		$('#spanAracTeslimLogs').click(function () {

			$('#divModelIsEmriAracTeslimLogGecmisi').load('@Url.Action("IsEmriAracTeslimGecmisi", "IsEmri", new { IsEmriId  = Model.isEmri.IsEmriId})');

			document.getElementById('ModelIsEmriAracTeslimLogGecmisi').style.display = 'block';

			return false;
		});

		$('.btnDyiEkleWithBelirtiKodu').click(function () {

			var BelirtiKodu = $(this).attr("BelirtiKodu");

			$('#divDyiEkle').load('/IsEmri/IsEmriDyiEkle?IsEmriId=@Model.isEmri.IsEmriId&BelirtiKodu=' + BelirtiKodu);

			document.getElementById('ModalDyiEkle').style.display = 'block';

			return false;

		});

		$('#btnIsEmriParcaEkle').click(function () {

			$('#divIsEmriParcaEkle').load('@Url.Action("IsEmriStokKartEkle", "IsEmri", new { IsEmriId  = Model.isEmri.IsEmriId })');

			document.getElementById('ModalParcaEkle').style.display = 'block';

			return false;

		});

		$('#btnIsEmriParcaEkleNew').click(function () {

			$('#divIsEmriParcaEkle').load('/IsEmri/IsEmriStokKartEkleNew?IsEmriId=@Model.isEmri.IsEmriId&MasterPage=1');

			document.getElementById('ModalParcaEkle').style.display = 'block';

			return false;

		});

		$('.btnIsEmriParcaEkleWithBelirtiKodu').click(function () {
			debugger;
			var BelirtiKodu = $(this).attr("BelirtiKodu");

			//$('#divIsEmriParcaEkle').load('/IsEmri/IsEmriStokKartEkle?IsEmriId=@Model.isEmri.IsEmriId&BelirtiKodu=' + BelirtiKodu + '&MasterPage=1');
			$('#divIsEmriParcaEkle').load('/IsEmri/IsEmriStokKartEkleNew?IsEmriId=@Model.isEmri.IsEmriId&BelirtiKodu=' + BelirtiKodu + '&MasterPage=1');

			document.getElementById('ModalParcaEkle').style.display = 'block';

			return false;

		});

		$('#btnIsEmriPaketEkle').click(function () {

			@*$('#divIsEmriPaketEkle').load('@Url.Action("IsEmriPaketEkle", "IsEmri", new { IsEmriId  = Model.isEmri.IsEmriId, CompanyId = Model.isEmri.Arac.CompanyId })');*@
			$('#divIsEmriPaketEkle').load('/IsEmri/IsEmriPaketEkle?IsEmriId=@Model.isEmri.IsEmriId&CompanyId=@Model.isEmri.Arac?.CompanyId');

			document.getElementById('ModalPaketEkle').style.display = 'block';

			return false;

		});

		$('.btnIsEmriPaketEkleWihtBelirtiKodu').click(function () {
			debugger;
			var BelirtiKodu = $(this).attr("BelirtiKodu");
			$('#divIsEmriPaketEkle').load('/IsEmri/IsEmriPaketEkle?IsEmriId=@Model.isEmri.IsEmriId&CompanyId=@Model.isEmri.Arac?.CompanyId&BelirtiKodu=' + BelirtiKodu);

			document.getElementById('ModalPaketEkle').style.display = 'block';

			return false;

		});

		$('#btnStokAl').click(function () {
			debugger;
			var BelirtiKodu = $(this).attr("BelirtiKodu");
			//$('#divStokAl').load('/IsEmri/IsEmriStokAl?IsEmriId=@Model.isEmri.IsEmriId&CompanyId=@Model.isEmri.Arac?.CompanyId&BelirtiKodu=' + BelirtiKodu);
			$('#divStokAl').load('/IsEmri/IsEmriStokAl?IsEmriId=@Model.isEmri.IsEmriId');

			document.getElementById('ModalStokAl').style.display = 'block';

			return false;

		});


		$('#btnIskontoEkle').click(function () {
			$('#BelirtiKoduGenelIskonto').val('');
			document.getElementById('ModalIskontoEkle').style.display = 'block';

			return false;

		});

		$('.btnIskontoEkleWithBelirtiKodu').click(function () {
			debugger;
			var BelirtiKoduGenelIskonto = $(this).attr('BelirtiKodu');
			$('#BelirtiKoduGenelIskonto').val(BelirtiKoduGenelIskonto);

			document.getElementById('ModalIskontoEkle').style.display = 'block';

			return false;

		});

		$('#btnIsEmriIptalEt').click(function () {

			if (isEmriStatu != @SahinRektefiyeSoln.Models.Parameters.IsEmriAcikStatu) {
				return false;
			}

			document.getElementById('ModalIsEmriIptalEt').style.display = 'block';

			return false;

		});

		$('#btnIsEmriniMuhasebeyeGonder').click(function () {
			//debugger;
			console.log(KdvHaricTutar);

			if (KdvHaricTutar.replace(',', '.') * 1 == 0) {
				$('#divMuhasebeyeGonder').removeClass("w3-show").addClass("w3-hide");
				$('#divBedelsizOnayGonder').removeClass("w3-hide").addClass("w3-show");
			}
			else {
				$('#divMuhasebeyeGonder').removeClass("w3-hide").addClass("w3-show");
				$('#divBedelsizOnayGonder').removeClass("w3-show").addClass("w3-hide");
			}

			if (isEmriStatu != @SahinRektefiyeSoln.Models.Parameters.IsEmriAcikStatu) {
				return false;
			}

			document.getElementById('ModalIsEmriniFaturala').style.display = 'block';

			return false;

		});

		var IsEmriTipleri = '@(string.Join(",", Model.isEmri.IsEmriBelirtiKodlari.Select(x => x.IsEmriTipId).ToList()))';

        console.log(IsEmriTipleri);

		jQuery.extend(jQuery.fn.dataTableExt.oSort, {
            'locale-compare-asc': function (a, b) {
                return a.localeCompare(b, 'cs', { sensitivity: 'case' })
            },
            'locale-compare-desc': function (a, b) {
                return b.localeCompare(a, 'cs', { sensitivity: 'case' })
            }
        })

        jQuery.fn.dataTable.ext.type.search['locale-compare'] = function (data) {
            return NeutralizeAccent(data);
        }

        function NeutralizeAccent(data) {
            return !data
                ? ''
                : typeof data === 'string'
                    ? data
                        .replace(/\n/g, ' ')
                        .replace(/[éÉěĚèêëÈÊË]/g, 'e')
                        .replace(/[šŠ]/g, 's')
                        .replace(/[čČ]/g, 'c')
                        .replace(/[řŘ]/g, 'r')
                        .replace(/[žŽ]/g, 'z')
                        .replace(/[ýÝ]/g, 'y')
                        .replace(/[áÁâàÂÀ]/g, 'a')
                        .replace(/[íÍîïÎİÏ]/g, 'i')
                        .replace(/[ťŤ]/g, 't')
                        .replace(/[ďĎ]/g, 'd')
                        .replace(/[ňŇ]/g, 'n')
                        .replace(/[óÓ]/g, 'o')
                        .replace(/[úÚůŮ]/g, 'u')
                    : data
        }

		jQuery.each(IsEmriTipleri.split(','), function (index, item) {
			if (item != "") {
				console.log("Belirti Kodu Eklendiği tespit edildi, belirti kodları için tablo oluşturulacak.IsEmriTipID : " + item)
				$('#tableIsEmriKalemleri' + item).DataTable({
					paging: false,
					dom: 'Bfrtip',
					buttons: [
						{
							text: 'Hepsini Seç',
							action: function (e, dt, node, config) {
								//alert('Button activated');
								debugger;
								var boxes = $('.kalemWillDelete' + item);

								boxes.each(function (index) {
									$(this)[0].checked = true;

								});
							},
							className: ''
						},
						{
							text: 'Kalemleri Kopyala',
							action: function (e, dt, node, config) {
								var urlField = document.getElementById("tableofParts");
								// create a Range object
								var range = document.createRange();
								// set the Node to select the "range"
								range.selectNode(urlField);
								// add the Range to the set of window selections
								window.getSelection().addRange(range);
								// execute 'copy', can't 'cut' in this case
								document.execCommand('copy');
								toastr.success("Parçalar Ctrl+V ye kopyalandı.", "İşlem Başarılı.");
							},
							className: ''
						}
					],
					"processing": true,
					"filter": true,
					"language": {
						"sEmptyTable": "Tabloda herhangi bir veri mevcut değil",
						"oPaginate": { "sFirst": "İlk", "sLast": "Son", "sNext": "İleri", "sPrevious": "Geri" },
						"select": { "rows": { "_": "%d kayıt seçildi", "0": "", "1": "1 kayıt seçildi" } },
						"sSearch": "",
						"selectAll": "Tümünü Seç",
						"sSearchPlaceholder": "Filtrele",
						"sLengthMenu": "_MENU_",
						"sLoadingRecords": "Yükleniyor...",
						"sProcessing": "İşleniyor...",
						"sZeroRecords": "Eşleşen kayıt bulunamadı...",
						"sInfo": "_TOTAL_ kayıttan _START_ - _END_ arasındaki kayıtlar.",
						"sInfoFiltered": "(_MAX_ kayıt içerisinden bulunan)",
						"sInfoEmpty": "Kayıt Yok",
						"sInfoPostFix": "",
						"sInfoThousands": ".",
						"sDecimal": ","
					},
            columnDefs : [
							 { targets: 0, type: 'locale-compare' },
						  ]
					,
					"footerCallback": function (row, data, start, end, display) {
						var api = this.api(), data;

						// Remove the formatting to get integer data for summation
						var intVal = function (i) {
							return typeof i === 'string' ?
								//i.replace(/[\$,]/g, '') * 1 :
								i.replace(',', '.') * 1 :
								typeof i === 'number' ?
									i : 0;
						};

						// Total over all pages
						total = api
							.column(14)
							.data()
							.reduce(function (a, b) {
								return intVal(a) + intVal(b);
							}, 0);

						// Total over this page
						pageTotal = api
							.column(14, { page: 'current' })
							.data()
							.reduce(function (a, b) {
								return intVal(a) + intVal(b);
							}, 0);

						// Update footer
						$(api.column(14).footer()).html(
							//'₺' + pageTotal + ' ( $' + total + ' total)'
							total.toFixed(2) + ' ₺'
						);
					}
				});

			}

		});

		$('#tableIsEmriKalemleri').DataTable({
			paging: false,
			dom: 'Bfrtip',
			buttons: [
				{
					text: 'Hepsini Seç',
					action: function (e, dt, node, config) {
						//alert('Button activated');

						var boxes = $('.kalemWillDelete');

						boxes.each(function (index) {
							$(this)[0].checked = true;

						});
					},
					className: ''
				},
				{
					text: 'Kalemleri Kopyala',
					action: function (e, dt, node, config) {
						var urlField = document.getElementById("tableofParts");
						// create a Range object
						var range = document.createRange();
						// set the Node to select the "range"
						range.selectNode(urlField);
						// add the Range to the set of window selections
						window.getSelection().addRange(range);
						// execute 'copy', can't 'cut' in this case
						document.execCommand('copy');
						toastr.success("Parçalar Ctrl+V ye kopyalandı.", "İşlem Başarılı.");
					},
					className:''
				}
			],
			"processing": true,
			"filter": true,
			"language": {
				"sEmptyTable": "Tabloda herhangi bir veri mevcut değil",
				"oPaginate": { "sFirst": "İlk", "sLast": "Son", "sNext": "İleri", "sPrevious": "Geri" },
				"select": { "rows": { "_": "%d kayıt seçildi", "0": "", "1": "1 kayıt seçildi" } },
				"sSearch": "",
				"selectAll": "Tümünü Seç",
				"sSearchPlaceholder": "Filtrele",
				"sLengthMenu": "_MENU_",
				"sLoadingRecords": "Yükleniyor...",
				"sProcessing": "İşleniyor...",
				"sZeroRecords": "Eşleşen kayıt bulunamadı...",
				"sInfo": "_TOTAL_ kayıttan _START_ - _END_ arasındaki kayıtlar.",
				"sInfoFiltered": "(_MAX_ kayıt içerisinden bulunan)",
				"sInfoEmpty": "Kayıt Yok",
				"sInfoPostFix": "",
				"sInfoThousands": ".",
				"sDecimal": ","
			},
            columnDefs : [
							 { targets: 0, type: 'locale-compare' },
						  ]
			,
			"footerCallback": function (row, data, start, end, display) {
				var api = this.api(), data;

				// Remove the formatting to get integer data for summation
				var intVal = function (i) {
					return typeof i === 'string' ?
						//i.replace(/[\$,]/g, '') * 1 :
						i.replace(',', '.') * 1:
						typeof i === 'number' ?
							i : 0;
				};

				// Total over all pages
				total = api
					.column(15)
					.data()
					.reduce(function (a, b) {
						return intVal(a) + intVal(b);
					}, 0);

				// Total over this page
				pageTotal = api
					.column(15, { page: 'current' })
					.data()
					.reduce(function (a, b) {
						return intVal(a) + intVal(b);
					}, 0);

				// Update footer
				$(api.column(15).footer()).html(
					//'₺' + pageTotal + ' ( $' + total + ' total)'
					total.toFixed(2)+ ' ₺'
				);
			}
		});        $("input[type='search']").keyup(function () {
            table.search(
                jQuery.fn.dataTable.ext.type.search.string(NeutralizeAccent(this.value))
            )
                .draw()

        });

		$('#tableIsEmriKalemleri').attr("style", "");

		$('#btnSecimleriSil').click(function () {
			debugger;
			var checkboxes = $('.kalemWillDelete');
			var kalemIds = [];
			checkboxes.each(function (index) {
				if ($(this)[0].checked) {
					kalemIds.push($(this)[0].getAttribute('kalemid'));
				}
			});

			//console.log(kalemIds); Buraya ajax call eklenecek !!!! silecek kalemleri

			var urlSecilenleriSil = '@Url.Action("IsEmriSeciliParcalariSil", "IsEmri")';

			var data = {
				isEmriId : @Model.isEmri.IsEmriId,
				kalemIds: kalemIds
			};

			console.log(data);
			WaitBlockUI(2000, 'Seçili parçalar siliniyor...');
			$.ajax({
				type: "POST",
				url: urlSecilenleriSil,
				content: "application/json; charset=utf-8",
				dataType: "json",
				data: data,//JSON.stringify(),
				success: function (d) {
					if (d.result == 1)
						//alert(d.responseText);

						location.reload();

					else {
						alert(d.message);
					}
				},
				error: function (xhr, textStatus, errorThrown) {
					alert('Error2 \n' + data);// TODO: Show error
				}
			});
		});

		$('.btnSecimleriSil').click(function () {
			debugger;
			var BelirtiKodu = $(this).attr('BelirtiKodu');
			var checkboxes = $('.kalemWillDelete' + BelirtiKodu);
			var kalemIds = [];
			checkboxes.each(function (index) {
				if ($(this)[0].checked) {
					kalemIds.push($(this)[0].getAttribute('kalemid'));
				}
			});

			//console.log(kalemIds); Buraya ajax call eklenecek !!!! silecek kalemleri

			var urlSecilenleriSil = '@Url.Action("IsEmriSeciliParcalariSil", "IsEmri")';

			var data = {
				isEmriId : @Model.isEmri.IsEmriId,
				kalemIds: kalemIds
			};

			console.log(data);
			WaitBlockUI(2000, 'Seçili parçalar siliniyor...');
			$.ajax({
				type: "POST",
				url: urlSecilenleriSil,
				content: "application/json; charset=utf-8",
				dataType: "json",
				data: data,//JSON.stringify(),
				success: function (d) {
					if (d.result == 1)
						//alert(d.responseText);

						location.reload();

					else {
						alert(d.message);
					}
				},
				error: function (xhr, textStatus, errorThrown) {
					alert('Error2 \n' + data);// TODO: Show error
				}
			});
		});

		$('#btnParcalariTeslimEt').click(function () {
			//var checkboxes = $('.kalemWillDelete');
			//var kalemIds = [];
			//checkboxes.each(function (index) {
			//	if ($(this)[0].checked) {
			//		kalemIds.push($(this)[0].getAttribute('kalemid'));
			//		alert('Teslim edilicek : ' +$(this)[0].getAttribute('kalemid'));
			//	}
			//});

			$('#divParcaYonet').load('@Url.Action("IsEmriParcaYonet", "IsEmri", new { IsEmriId  = Model.isEmri.IsEmriId})');

			document.getElementById('ModalParcaYonet').style.display = 'block';

			return false;

		});


		$('.btnkalemIskonto').click(function () {
			//alert($(this)[0].getAttribute('IsEmriKalemId'));

			//KalemBazlıIsemrineHiddenSetEt.
			var isEmriKalemId = $(this)[0].getAttribute('IsEmriKalemId');
			$('#kalemIskontoIsEmriId').val(isEmriKalemId);

			//PopUp Açılacak!
			document.getElementById('ModalKalemIskontoEkle').style.display = 'block';

		});

		$('#btnIconTeslimEdenKullanıcı').click(function () {
			var isEmriId = '@Model.isEmri.IsEmriId';
			$('#divIsEmriTeslimAlanEdenKullaniciEkle').load('@Url.Action("IsEmriTeslimAlanEdenKullaniciEkle", "IsEmri")?IsEmriId=@Model.isEmri.IsEmriId&TeslimTipi=V');

			document.getElementById('ModalIsEmriTeslimAlanEdenKullaniciEkle').style.display = 'block';

			return false;
		});

		$('#btnIconTeslimAlanKullanıcı').click(function () {
			var isEmriId = '@Model.isEmri.IsEmriId';
			$('#divIsEmriTeslimAlanEdenKullaniciEkle').load('@Url.Action("IsEmriTeslimAlanEdenKullaniciEkle", "IsEmri")?IsEmriId=@Model.isEmri.IsEmriId&TeslimTipi=A');

			document.getElementById('ModalIsEmriTeslimAlanEdenKullaniciEkle').style.display = 'block';

			return false;
		});

		$('#inputKm').change(function () {

			debugger;
			var value = $('#inputKm').val();
			var oldValue = $('#inputKm').attr("oldKmValue");

			var IsEmriId = '@Model.isEmri.IsEmriId';
			var AracId = '@(Model.isEmri.Arac?.AracId)';

			if (value != oldValue) {
				debugger;
				var answer = window.confirm("Km Güncellemek istiyor musunuz?");
				if (answer) {

					var data = {
						IsEmriId: IsEmriId,
						AracId: AracId,
						NewKmValue: value
					};
					console.log(data);
					var urlAracKmGuncelle = '@Url.Action("AracKmGuncelle", "IsEmri")';

					$.ajax({
						type: "POST",
						url: urlAracKmGuncelle,
						content: "application/json; charset=utf-8",
						dataType: "json",
						data: data,//JSON.stringify(),
						success: function (d) {
							if (d.result == 1)
								//alert(d.responseText);
								showToaster('Success', 'Km güncellendi.', 'Başarılı');
							else {
								showToaster('Error', 'Km güncellenirken hata oluştu.', 'HATA');

							}
						},
						error: function (xhr, textStatus, errorThrown) {
							showToaster('Error', 'Km güncellenirken hata oluştu.', 'HATA');
						}
					});
				}
				else {
					return false;
				}

			}

		});

		$('#AracTeslimEdenKisiManuel').change(function () {

			var value = $('#AracTeslimEdenKisiManuel').val();
			var IsEmriId = '@Model.isEmri.IsEmriId';

			if (value != "") {

				var answer = window.confirm("Teslim eden kişiyi güncellemek istiyor musunuz?");
				if (answer) {

					var data = {
						IsEmriId: IsEmriId,
						AracTeslimEdenKisi: value
					};
					console.log(data);

					var AracTeslimEdenKisiGuncelle = '@Url.Action("AracTeslimEdenKisiGuncelle", "IsEmri")';

					$.ajax({
						type: "POST",
						url: AracTeslimEdenKisiGuncelle,
						content: "application/json; charset=utf-8",
						dataType: "json",
						data: data,
						success: function (d) {
							if (d.result == 1)
								//alert(d.responseText);
								showToaster('Success', 'Teslim eden kişi güncellendi.', 'Başarılı');
							else {
								showToaster('Error', 'Teslim eden kişi güncellenirken hata oluştu.', 'HATA');

							}
						},
						error: function (xhr, textStatus, errorThrown) {
							showToaster('Error', 'Teslim eden kişi güncellenirken hata oluştu.', 'HATA');
						}
					});
				}
				else {
					return false;
				}

			}

		});

		$('.btnFaturaKes').click(function () {
			debugger;
			$('#FaturaMessage').html($(this).attr('displayIsEmri'));

			var FaturaTipi = $(this).attr('FaturaTipi');
			var FaturaId = $(this).attr('FaturaId');
			var IsEmriId = $(this).attr('IsEmriId')
			var IsEmriTipi = $(this).attr('IsEmriTipi');
			$('#mdlFaturaId').val(FaturaId);
			$('#mdlIsEmriId').val(IsEmriId);
			$('#mdlIsEmriTipi').val(IsEmriTipi);
			$('#FaturaTipi').val(FaturaTipi);

			if (IsEmriTipi == "Irsaliye") {
				$("#male").prop("checked", true);
				$('#female').attr("disabled", "disabled");
				$('#divFaturaNo').removeClass("w3-hide").addClass("w3-show");
				$('#divFisNo').removeClass("w3-show").addClass("w3-hide");
			}
			else {
				$('#mdlFaturaNo').val('');

				if (FaturaTipi == "20") // Fiş kesilecek demektir.
				{

					$('#mdlFaturaNo').attr("disabled", "disabled");
					$('#btnFaturaFisOlustur').html('Fiş Oluştur');
					$('#lblFaturaFisNumarasi').html('Fiş Numarası');
					$('#fisMessage').removeClass('w3-hide').addClass('w3-show');

				}
				else // Normal Faturadır
				{
					$('#mdlFaturaNo').removeAttr("disabled");
					$('#btnFaturaFisOlustur').html('Fatura Oluştur');
					$('#lblFaturaFisNumarasi').html('Fatura Numarası');

					$('#fisMessage').removeClass('w3-show').addClass('w3-hide');
				}

			}

			document.getElementById('modalFatura').style.display = 'block';

			return false;

		});


		$('.BelirtiKoduSeriNoGuncelle').change(function () {

			var BelirtiKodu = $(this).attr("BelirtiKodu");
			var IsEmriId = '@Model.isEmri.IsEmriId';
			var value = $(this).val();

			if (value != "") {

				var data = {
					BelirtiKodu: BelirtiKodu,
					IsEmriId: IsEmriId,
					value: value,
					Type : "SeriNo"
				};
				console.log(data);

				var BelirtiKoduDetayGuncelleUrl = '@Url.Action("BelirtiKoduDetayGuncelle", "IsEmri")';

				$.ajax({
					type: "POST",
					url: BelirtiKoduDetayGuncelleUrl,
					content: "application/json; charset=utf-8",
					dataType: "json",
					data: data,
					success: function (d) {
						if (d.result == 1)
							showToaster('Success', 'Seri No güncellendi.', 'Başarılı');
						else {
							showToaster('Error', 'Seri No güncellenirken hata oluştu.', 'HATA');

						}
					},
					error: function (xhr, textStatus, errorThrown) {
						showToaster('Error', 'Seri No güncellenirken hata oluştu, sistem geliştiriciniz ile irtibata geçiniz.', 'HATA');
					}
				});
			}



		});

		$('.BelirtiKoduPartNoGuncelle').change(function () {

			var BelirtiKodu = $(this).attr("BelirtiKodu");
			var IsEmriId = '@Model.isEmri.IsEmriId';
			var value = $(this).val();

			if (value != "") {

				var data = {
					BelirtiKodu: BelirtiKodu,
					IsEmriId: IsEmriId,
					value: value,
					Type : "PartNo"
				};
				console.log(data);

				var BelirtiKoduDetayGuncelleUrl = '@Url.Action("BelirtiKoduDetayGuncelle", "IsEmri")';

				$.ajax({
					type: "POST",
					url: BelirtiKoduDetayGuncelleUrl,
					content: "application/json; charset=utf-8",
					dataType: "json",
					data: data,
					success: function (d) {
						if (d.result == 1)
							showToaster('Success', 'Part No güncellendi.', 'Başarılı');
						else {
							showToaster('Error', 'Part No güncellenirken hata oluştu.', 'HATA');

						}
					},
					error: function (xhr, textStatus, errorThrown) {
						showToaster('Error', 'Part No güncellenirken hata oluştu, sistem geliştiriciniz ile irtibata geçiniz.', 'HATA');
					}
				});
			}

		});

		$('.BelirtiKoduAciklamaGuncelle').change(function () {
			var BelirtiKodu = $(this).attr("BelirtiKodu");
			var IsEmriId = '@Model.isEmri.IsEmriId';
			var value = $(this).val();

			if (value != "") {

				var data = {
					BelirtiKodu: BelirtiKodu,
					IsEmriId: IsEmriId,
					value: value,
					Type : "Aciklama"
				};
				console.log(data);

				var BelirtiKoduDetayGuncelleUrl = '@Url.Action("BelirtiKoduDetayGuncelle", "IsEmri")';

				$.ajax({
					type: "POST",
					url: BelirtiKoduDetayGuncelleUrl,
					content: "application/json; charset=utf-8",
					dataType: "json",
					data: data,
					success: function (d) {
						if (d.result == 1)
							showToaster('Success', 'Açıklama güncellendi.', 'Başarılı');
						else {
							showToaster('Error', 'Açıklama güncellenirken hata oluştu.', 'HATA');

						}
					},
					error: function (xhr, textStatus, errorThrown) {
						showToaster('Error', 'Açıklama güncellenirken hata oluştu, sistem geliştiriciniz ile irtibata geçiniz.', 'HATA');
					}
				});
			}
		});


		$('#inpSwAracInService').change(function() {

			var Message = "";
			if (this.checked) {
				Message = "Araç serviste olarak güncellenecek, devam etmek istiyor musunuz ?"
			} else {
				Message = "Araç servisten çıktı olarak güncellenecek, devam etmek istiyor musunuz ?"
			}

			var answer = window.confirm(Message);

				if (answer) {

					var data = {
						IsEmriId: @Model.isEmri.IsEmriId,
						AracServisteMi: this.checked
					};

					console.log(data);
					var urlAracKmGuncelle = '@Url.Action("AracServisteMiGuncelle", "IsEmri")';

					$.ajax({
						type: "POST",
						url: urlAracKmGuncelle,
						content: "application/json; charset=utf-8",
						dataType: "json",
						data: data,//JSON.stringify(),
						success: function (d) {
							if (d.result == 1)
								//alert(d.responseText);
								showToaster('Success', 'Başarıyla Güncellendi.', 'Başarılı');
							else {
								showToaster('Error', 'Araç teslim logu atarken hata oluştu.', 'HATA');

							}
						},
						error: function (xhr, textStatus, errorThrown) {
							showToaster('Error', 'Araç teslim logu atarken hata oluştu.', 'HATA');
						}
					});
				}
				else {
					return false;
				}

    });


	});
	function showToaster(resultType, body, header) {
		if (resultType == "Error") {
			toastr.error(body, header);
		}
		else if (resultType == "Success") {
			toastr.success(body, header);
		}
		else if (resultType == "Info") {
			toastr.info(body, header);
		}
		else if (resultType == "Warning") {
			toastr.warning(body, header);
		}

	}
	//
	function onPrintGunlukClick(BelirtiKodu)
	{
		if (BelirtiKodu == "") {
			window.open(
		   "@Request.Url.GetLeftPart(UriPartial.Authority)/IsEmri/IsEmriGunlukPrint?IsEmriId=@Model.isEmri.IsEmriId",
			'_blank' // <- This is what makes it open in a new window.
			 );
		} else {
			window.open(
		   "@Request.Url.GetLeftPart(UriPartial.Authority)/IsEmri/IsEmriGunlukPrint?IsEmriId=@Model.isEmri.IsEmriId&BelirtiKodu=" + BelirtiKodu,
			'_blank' // <- This is what makes it open in a new window.
			 );
		}

	}

	function onDownloadGunlukDocument(BelirtiKodu)
	{
		if (BelirtiKodu == "") {
			window.open("@Request.Url.GetLeftPart(UriPartial.Authority)/IsEmri/GunlukSaveOrderWithWordv2?IsEmriId=@Model.isEmri.IsEmriId");
		} else {
			window.open("@Request.Url.GetLeftPart(UriPartial.Authority)/IsEmri/GunlukSaveOrderWithWordv2?IsEmriId=@Model.isEmri.IsEmriId&BelirtiKodu=" + BelirtiKodu);
		}


	}

	function onPdfGunlukExport(BelirtiKodu) {
		if (BelirtiKodu == "") {
			window.open("@Request.Url.GetLeftPart(UriPartial.Authority)/IsEmri/ExportPdf?IsEmriId=@Model.isEmri.IsEmriId");
		}
		else {
			window.open("@Request.Url.GetLeftPart(UriPartial.Authority)/IsEmri/ExportPdf?IsEmriId=@Model.isEmri.IsEmriId&BelirtiKodu=" + BelirtiKodu);
			//window.open("@Request.Url.GetLeftPart(UriPartial.Authority)/IsEmri/DenemePdfYeni?IsEmriId=@Model.isEmri.IsEmriId&BelirtiKodu=" + BelirtiKodu);
		}

	}

	//
	function onPdfExport() {
		window.open("@Request.Url.GetLeftPart(UriPartial.Authority)/IsEmri/IsEmriPrintView?IsEmriId=@Model.isEmri.IsEmriId");
	}
	function onTsePdfExport() {
		window.open("@Request.Url.GetLeftPart(UriPartial.Authority)/IsEmri/IsEmriPrintViewTse?IsEmriId=@Model.isEmri.IsEmriId");
	}

	function onIsEmriExport() {
		window.open("@Request.Url.GetLeftPart(UriPartial.Authority)/IsEmri/IsEmriDetayPrint?IsEmriId=@Model.isEmri.IsEmriId");
	}
	function onExcelExport() {
		window.open("@Request.Url.GetLeftPart(UriPartial.Authority)/IsEmri/IsEmriExcelExportDeneme?IsEmriId=@Model.isEmri.IsEmriId");
	}

	function onKaliteFormExport() {
		window.open("@Request.Url.GetLeftPart(UriPartial.Authority)/IsEmri/IsEmriKaliteKontrolFormu?IsEmriId=@Model.isEmri.IsEmriId");
	}

	function readURL(input) {
		$("#WorkOrderImagesList").empty();
		$('#blah').removeClass("w3-hide").addClass('w3-show');
		for (var i = 0; i <= input.files.length; i++) {
			if (input.files && input.files[i]) {
				var reader = new FileReader();

				$('#blah').attr('src', '/Images/Loading1.gif');
				$('#barim').removeClass('w3-hide').addClass('w3-show');
				reader.readAsDataURL(input.files[i]);
				var elem = document.getElementById("myBar");
				var width = 1;
				var id = setInterval(frame, 5);
				function frame() {
					if (width >= 100) {
						clearInterval(id);
					} else {
						width++;
						elem.style.width = width + '%';
						document.getElementById("demo").innerHTML = width * 1 + '%';
					}
				}
				reader.onload = function (e) {

					$('.image-upload-wrap').hide();
					setTimeout(function () {
						//$('#blah').attr('src', e.target.result);
						var x = document.createElement("IMG");
						x.setAttribute("class", "w3-quarter w3-padding w3-border w3-margin-right")
						x.setAttribute("src", e.target.result);

						x.setAttribute("alt", "The Pulpit Rock");
						$('#WorkOrderImagesList').append(x);
						$('#barim').removeClass('w3-show').addClass('w3-hide');
						$('#blah').removeClass("w3-show").addClass('w3-hide');
					}, 500);

				}

			}

			if ($('#blah')[0].currentSrc = null) {
				$('#btnClear').removeClass("w3-show").addClass("w3-hide");
			} else {
				$('#btnClear').removeClass("w3-hide").addClass("w3-show");
			}



			$(" <div class='w3-col l3 m6 w3-margin-bottom'><div class='w3-display-container' id='" + i + '"> asdfasdf </div></div>"').appendTo('#Images');
		}

	}

	function WaitBlockUI(milisaniye, message) {

		$.blockUI({
			css: {
				border: 'none',
				padding: '15px',
				backgroundColor: '#000',
				'-webkit-border-radius': '10px',
				'-moz-border-radius': '10px',
				opacity: .5,
				color: '#fff'
			},
			message: message
		});

		setTimeout($.unblockUI, milisaniye);

	}
</script>
<style>
	#tableIsEmriKalemleri {
		font-family: tahoma;
	}

	#divIsEmriDetay {
		font-family: tahoma;
	}
</style>

<style>

	.file-upload-input {
		position: absolute;
		margin: 0;
		padding: 0;
		width: 100%;
		height: 100%;
		outline: none;
		opacity: 0;
		cursor: pointer;
	}

	.image-upload-wrap:hover {
		background-color: #f1f1f1 !important;
	}

	.drag-text {
		text-align: center;
	}

		.drag-text h3 {
			font-weight: 100;
			text-transform: uppercase;
			color: #15824B;
			padding: 60px 0;
		}
</style>
@using Vereyon.Web;
@Html.Action("SetPageHeader", "Admin", new { pageTitle = "İş Emri Detay Ekranı", pagePermission = "XXXXX" })

<div class="w3-panel">
	<div class="w3-row-padding w3-card">
		<div class="w3-row w3-row-padding  w3-margin-top">
			@Html.RenderFlashMessages()
		</div>
		@if (Model.isEmri.FaturalanacakMusteriId != null)
		{
			if (Model.isEmri.MusteriId != Model.isEmri.FaturalanacakMusteriId)
			{
				<div class="w3-panel w3-border w3-red w3-round w3-animate-left " style="margin-top: 0px;margin-bottom: 10px;font-family:Arial">

					<div class="w3-white w3-padding w3-round w3-margin-top w3-margin-bottom">
						<i class="fa fa-exclamation-triangle blink" aria-hidden="true"></i><b>MUHASEBENİN DİKKATİNE :  </b>
						<br />
						<div class="w3-padding">Müşteri : <a href="/Musteri/MusteriDuzenle?MusteriId=@Model.isEmri.Musteri.MusteriId" title="Müşteriye Git" target="_blank">@MusteriDesc2</a><br /></div>
						<div class="w3-padding">
							Faturalanacak Müşteri :
							<a href="/Musteri/MusteriDuzenle?MusteriId=@Model.isEmri.Musteri3.MusteriId" title="Faturalanacak Müşteriye Git" target="_blank">@FaturalanacakMusteri</a>
						</div>
					</div>
				</div>
			}
		}
		<div class="w3-panel w3-light-grey w3-round" style="margin-top: 0px;margin-bottom: 10px;font-family:Arial">
			<div class="w3-quarter">
				&nbsp;
				<div class="w3-left"><p><b>İş Emri Numarası :  	@(String.Format("{0:000000}", Model.isEmri.IsEmriId))</b></p></div>
			</div>
			<div class="w3-half w3-hide-small w3-padding-top w3-padding-right">
				<div class="w3-dropdown-hover w3-right">
					@switch (Model.isEmri.IsEmriTeklifStatusu)
					{
						case 5:
							<button class="w3-btn w3-teal w3-round">Servis Bekliyor.</button>
							break;
						case 10:
							<button class="w3-btn w3-teal w3-round">Teklif iletilmesi bekleniyor (İncelemede).</button>
							break;
						case 20:
							<button class="w3-btn w3-green w3-round">Teklif İletildi.</button>
							break;
						case 30:
							<button class="w3-btn w3-green w3-round">Teklif Onaylandı.</button>
							break;
						case 35:
							<button class="w3-btn w3-green w3-round">İşlemde.</button>
							break;
						case 40:
							<button class="w3-btn w3-green w3-round">İşlem Tamamlandı, Teslimata Hazır.</button>
							break;
						default:
							break;
					}
					<div class="w3-dropdown-content w3-bar-block w3-border" style="right:0">
						@if (Model.isEmri.IsEmriTeklifStatusu == 5)
						{
							using (Html.BeginForm("IsEmriTeklifStatuGuncelle", "IsEmri", FormMethod.Post))
							{
								@Html.HiddenFor(x => x.isEmri.IsEmriId)
								<button value="10" name="command" class="w3-bar-item w3-button">Teklif iletilmesi bekleniyor (İncelemede)</button>
								<button value="20" name="command" class="w3-bar-item w3-button">Teklif Gönderildi</button>
								<button value="30" name="command" class="w3-bar-item w3-button">Teklif Onaylandı</button>
								<button value="35" name="command" class="w3-bar-item w3-button">İşlemde  </button>
								<button value="40" name="command" class="w3-bar-item w3-button">İşlem Tamamlandı, Teslimata Hazır</button>
							}
						}
						else if (Model.isEmri.IsEmriTeklifStatusu == 10)
						{
							using (Html.BeginForm("IsEmriTeklifStatuGuncelle", "IsEmri", FormMethod.Post))
							{
								@Html.HiddenFor(x => x.isEmri.IsEmriId)

								<button value="10" name="command" class="w3-bar-item w3-button">Teklif iletilmesi bekleniyor (İncelemede)<br><span class="w3-small">@Model.isEmri.Dt_Teklif_Iletilmesi_Bekleniyor</span></button>
								<button value="20" name="command" class="w3-bar-item w3-button">Teklif Gönderildi</button>
								<button value="30" name="command" class="w3-bar-item w3-button">Teklif Onaylandı</button>
								<button value="35" name="command" class="w3-bar-item w3-button">İşlemde  </button>
								<button value="40" name="command" class="w3-bar-item w3-button">İşlem Tamamlandı, Teslimata Hazır</button>
							}
						}
						else if (Model.isEmri.IsEmriTeklifStatusu == 20)
						{
							using (Html.BeginForm("IsEmriTeklifStatuGuncelle", "IsEmri", FormMethod.Post))
							{
								@Html.HiddenFor(x => x.isEmri.IsEmriId)
								<button value="10" name="command" class="w3-bar-item w3-button">Teklif iletilmesi bekleniyor (İncelemede)<br><span class="w3-small">@Model.isEmri.Dt_Teklif_Iletilmesi_Bekleniyor</span></button>
								<button value="20" name="command" class="w3-bar-item w3-button">Teklif Gönderildi<br><span class="w3-small">@Model.isEmri.Dt_Teklif_Iletildi</span></button>
								<button value="30" name="command" class="w3-bar-item w3-button">Teklif Onaylandı</button>
								<button value="35" name="command" class="w3-bar-item w3-button">İşlemde  </button>
								<button value="40" name="command" class="w3-bar-item w3-button">İşlem Tamamlandı, Teslimata Hazır</button>
							}
						}
						else if (Model.isEmri.IsEmriTeklifStatusu == 30)
						{
							using (Html.BeginForm("IsEmriTeklifStatuGuncelle", "IsEmri", FormMethod.Post))
							{
								@Html.HiddenFor(x => x.isEmri.IsEmriId)
								<button value="10" name="command" class="w3-bar-item w3-button">Teklif iletilmesi bekleniyor (İncelemede)<br><span class="w3-small">@Model.isEmri.Dt_Teklif_Iletilmesi_Bekleniyor</span></button>
								<button value="20" name="command" class="w3-bar-item w3-button">Teklif Gönderildi<br><span class="w3-small">@Model.isEmri.Dt_Teklif_Iletildi</span></button>
								<button value="30" name="command" class="w3-bar-item w3-button">Teklif Onaylandı<br><span class="w3-small">@Model.isEmri.Dt_Teklif_Onaylandi</span></button>
								<button value="35" name="command" class="w3-bar-item w3-button">İşlemde  </button>
								<button value="40" name="command" class="w3-bar-item w3-button">İşlem Tamamlandı, Teslimata Hazır</button>
							}
						}
						else if (Model.isEmri.IsEmriTeklifStatusu == 35)
						{
							using (Html.BeginForm("IsEmriTeklifStatuGuncelle", "IsEmri", FormMethod.Post))
							{
								@Html.HiddenFor(x => x.isEmri.IsEmriId)
								<button value="10" name="command" class="w3-bar-item w3-button">Teklif iletilmesi bekleniyor (İncelemede)<br><span class="w3-small">@Model.isEmri.Dt_Teklif_Iletilmesi_Bekleniyor</span></button>
								<button value="20" name="command" class="w3-bar-item w3-button">Teklif Gönderildi<br><span class="w3-small">@Model.isEmri.Dt_Teklif_Iletildi</span></button>
								<button value="30" name="command" class="w3-bar-item w3-button">Teklif Onaylandı<br><span class="w3-small">@Model.isEmri.Dt_Teklif_Onaylandi</span></button>
								<button value="35" name="command" class="w3-bar-item w3-button">İşlemde <br><span class="w3-small">@Model.isEmri.Dt_Islemde</span> </button>
								<button value="40" name="command" class="w3-bar-item w3-button">İşlem Tamamlandı, Teslimata Hazır</button>
							}
						}
						else if (Model.isEmri.IsEmriTeklifStatusu == 40)
						{
							using (Html.BeginForm("IsEmriTeklifStatuGuncelle", "IsEmri", FormMethod.Post))
							{
								@Html.HiddenFor(x => x.isEmri.IsEmriId)
								<button value="10" name="command" class="w3-bar-item w3-button">Teklif iletilmesi bekleniyor (İncelemede)<br><span class="w3-small">@Model.isEmri.Dt_Teklif_Iletilmesi_Bekleniyor</span></button>
								<button value="20" name="command" class="w3-bar-item w3-button">Teklif Gönderildi<br><span class="w3-small">@Model.isEmri.Dt_Teklif_Iletildi</span></button>
								<button value="30" name="command" class="w3-bar-item w3-button">Teklif Onaylandı<br><span class="w3-small">@Model.isEmri.Dt_Teklif_Onaylandi</span></button>
								<button value="35" name="command" class="w3-bar-item w3-button">İşlemde <br><span class="w3-small">@Model.isEmri.Dt_Islemde</span> </button>
								<button value="40" name="command" class="w3-bar-item w3-button">İşlem Tamamlandı, Teslimata Hazır <br><span class="w3-small">@Model.isEmri.Dt_Islem_Tamamlandi</span> </button>
							}
						}


					</div>
				</div>
				&nbsp;
				@if (Model.isEmri.IsEmriStatuId == SahinRektefiyeSoln.Models.Parameters.IsEmriFaturaBekleniyor)
				{
					<div class="w3-left">
						<p class="w3-panel w3-round w3-yellow">Fatura Muhasebe tarafından kesilmesi bekleniyor.</p>
					</div>
				}
				else if (Model.isEmri.FaturaNo != null)
				{
					<div class="w3-left">
						<p>Fatura Tarihi: @Convert.ToDateTime(Model.isEmri.FaturaTarihi).ToShortDateString() &nbsp;&nbsp;&nbsp;Fatura No : @Model.isEmri.FaturaNo</p>
					</div>
				}


			</div>
			<div class="w3-quarter">

				<div class="w3-left w3-twothird">
					<p>İş Emri Giriş Tarihi: @Model.isEmri.CreatedDate.ToShortDateString() </p>

				</div>

				<div class="w3-right w3-third w3-margin-top">

					@if (isEmriGunlukIds.Contains(Model.isEmri.IsEmriTipId) && SahinRektefiyeSoln.Models.Parameters.ServiceBankoSatisIsEmriTipId != Model.isEmri.IsEmriTipId)
					{

						<span style="cursor:alias"><i class="fa fa-file-word-o" aria-hidden="true" onclick="onDownloadGunlukDocument();"></i></span>
						<span style="cursor:alias"><i class="fa fa-file-pdf-o " aria-hidden="true" onclick="onPdfGunlukExport();"></i></span>
						<span style="cursor:alias"><i class="fa  fa-print" aria-hidden="true" onclick="onPrintGunlukClick();"></i></span>
					}

					<span class="w3-right w3-padding-lr-4" style="cursor:alias" title="İş Emri Dökümünü Yazdır"> &nbsp;<i class="fa fa-print w3-text-green" aria-hidden="true" onclick="onIsEmriExport();"></i></span>
					<span class="w3-right" style="cursor:alias" title="İş Excel Döküm"> &nbsp;<i class="fa fa-file-excel-o w3-text-blue" aria-hidden="true" onclick="onExcelExport();"></i></span>
					<span class="w3-right" style="cursor:alias" title="İş Emrini Yazdır"> &nbsp;<i class="fa fa-print w3-text-blue" aria-hidden="true" onclick="onPdfExport();"></i></span>
					<span class="w3-right" style="cursor:alias" title="İş Emrini Yazdır"> &nbsp;<i class="fa fa-print w3-text-yellow" aria-hidden="true" onclick="onTsePdfExport();"></i></span>
					<span class="w3-right" style="cursor:alias" title="Kalite Formu Yazdır"> &nbsp;<img src="~/Images/quality-icon-20.jpg" onclick="onKaliteFormExport();" width="13" height="13" /></span>


				</div>
			</div>

		</div>
		@if (Model.isEmri.SwBedelsizOnay && Model.isEmri.IsEmriStatuId == SahinRektefiyeSoln.Models.Parameters.IsEmriBedelsizOnayBekliyor)
		{
			<div class="w3-panel w3-pale-yellow w3-border w3-round" style="margin-top: 0px;margin-bottom: 10px;font-family:Arial">

				<div class="w3-padding-top  w3-padding-bottom">
					<label>
						İş Emri bedelsiz onay bekliyor. Gönderilen Tarih : @Model.isEmri.DtBedelsizOnayGonderilenTarih.Value.ToShortDateString():@Model.isEmri.DtBedelsizOnayGonderilenTarih.Value.ToShortTimeString() - Gönderen Kişi @Model.isEmri.CdBedelsizOnayGonderenKisi
					</label>
					<label><b>Açıklaması : </b> @Model.isEmri.BedelsizAciklamasi</label>
					<a href="/IsEmri/BedelsizOnayıGeriCek?IsEmriId=@Model.isEmri.IsEmriId" class="w3-btn w3-red w3-round"> Onayı Geri Çek</a>
				</div>

			</div>
		}
		else if (Model.isEmri.SwBedelsizOnay && Model.isEmri.IsEmriStatuId == SahinRektefiyeSoln.Models.Parameters.IsEmriTamamlandiStatu)
		{
			<div class="w3-panel w3-pale-yellow w3-border w3-round" style="margin-top: 0px;margin-bottom: 10px;font-family:Arial">

				<div class="w3-padding-top  w3-padding-bottom">
					<label>
						İş Emri bedelsiz onaylandı. Gönderilen Tarih : @Model.isEmri.DtBedelsizOnayGonderilenTarih.Value.ToShortDateString():@Model.isEmri.DtBedelsizOnayGonderilenTarih.Value.ToShortTimeString() - Gönderen Kişi @Model.isEmri.CdBedelsizOnayGonderenKisi
						<br />
					</label>
					<label><b>Açıklaması : </b> @Model.isEmri.BedelsizAciklamasi</label><br />
					<label>Onaylanan Tarih : @Model.isEmri.DtBedelsizOnayTarihi.Value.ToShortDateString():@Model.isEmri.DtBedelsizOnayTarihi.Value.ToShortTimeString() - Onaylayan Kişi : @Model.isEmri.CdBedelsizOnaylayanKisi</label>
				</div>

			</div>
		}
		<div class="w3-row w3-border w3-round">
			<!--İş Emri Bilgileri-->
			<div class="w3-third w3-padding-right">
				<table class=" w3-striped w3-white" cellpadding="4" cellspacing="2" width="100%">
					<thead>
						<tr>
							<td colspan="100%" class="w3-center w3-round w3-blue">İş Emri Bilgileri</td>
						</tr>
					</thead>
					<tbody>
						@*<tr>
								<td>İş Emri No</td>
								<td>@Model.isEmri.IsEmriId</td>
								<td>İş Emri Tarihi</td>
								<td>@Model.isEmri.CreatedDate.ToShortDateString() </td>
							</tr>*@
						<tr>
							<td>İş Emri Tipi</td>
							<td><b>@Model.isEmri.IsEmriTipleri.Aciklamasi</b></td>
							<td>Danışman</td>
							<td>@Model.isEmri.Danismanlar.Adi @Model.isEmri.Danismanlar.Soyadi</td>
						</tr>
						<tr>
							<td>Vip</td>
							<td><i class="fa @(Model.isEmri.SwVip== false ? "fa-times-circle w3-text-red" : "fa-check-circle w3-text-green") w3-large" aria-hidden="true"></i></td>
							<td>İnteraftif</td>
							<td><i class="fa @(Model.isEmri.SwInteraktif== false ? "fa-times-circle w3-text-red" : "fa-check-circle w3-text-green") w3-large" aria-hidden="true"></i></td>
						</tr>
						<tr>
							<td>Garanti var mı</td>
							<td><i class="fa @(Model.isEmri.SwWarranty== false ? "fa-times-circle w3-text-red" : "fa-check-circle w3-text-green") w3-large" aria-hidden="true"></i></td>
							<td>Önceden Revizyon </td>
							<td><i class="fa @(Model.isEmri.SwRevision== false ? "fa-times-circle w3-text-red" : "fa-check-circle w3-text-green") w3-large" aria-hidden="true"></i></td>
						</tr>
						<tr>
							<td>Tekrar İş</td>
							<td><i class="fa @(Model.isEmri.SwTekrarlananIs== false ? "fa-times-circle w3-text-red" : "fa-check-circle w3-text-green") w3-large" aria-hidden="true"></i></td>
							<td><span title="İş Emri açıldığı andaki kilometresini ifade eder">İş Emri Km</span></td>
							<td>@Model.isEmri.Km</td>
						</tr>
						<tr>
							<td colspan="4">
								Tahmini Teslim Tarihi : <i>@(Model.isEmri.TahminiTeslimTarihi != null ? Model.isEmri.TahminiTeslimTarihi.Value.ToShortDateString() + " " + Model.isEmri.TahminiTeslimTarihi.Value.ToShortTimeString() : "Belirtilmemiş")</i>
							</td>
						</tr>
						<tr>
							<td colspan="2">
								Teslim Eden Kişi :
							</td>
							<td colspan="2">
								<i class="fa fa-user-plus w3-hover-opacity" style="cursor:pointer" aria-hidden="true" id="btnIconTeslimEdenKullanıcı" title="Değiştir"></i>&nbsp;&nbsp;
								@if (Model.isEmri.AraciTeslimEdenMusteriId != null)
								{
									<label>@(Model.isEmri.Musteri1.MusteriTipi == "B" ? (Model.isEmri.Musteri1.MusteriAdi.ToString() + " " + Model.isEmri.Musteri1.MusteriSoyadi.ToString()) : Model.isEmri.Musteri1.KurumAdi.ToString())</label>
								}
								else
								{
									<style>
										#AracTeslimEdenKisiManuel {
											background: transparent;
											border: none;
										}
									</style>
									<input id="AracTeslimEdenKisiManuel" class="w3-hover-white w3-round w3-padding-left" type="text" value="@Model.isEmri.AracTeslimEdenKisi" />
								}
							</td>
						</tr>
						<tr>
							<td colspan="2">
								Teslim Alan Kişi :
							</td>
							<td colspan="2">
								<i class="fa fa-user-plus w3-hover-opacity" style="cursor:pointer" aria-hidden="true" id="btnIconTeslimAlanKullanıcı" title="Değiştir"></i>&nbsp;&nbsp;

								@if (Model.isEmri.AraciTeslimAlanMusteriId != null)
								{
									<label>@(Model.isEmri.Musteri2.MusteriTipi == "B" ? (Model.isEmri.Musteri2.MusteriAdi.ToString() + " " + Model.isEmri.Musteri2.MusteriSoyadi.ToString()) : Model.isEmri.Musteri2.KurumAdi.ToString())</label>

								}
								else
								{
									<i>Belirtilmemiş&nbsp;</i>
								}

							</td>
						</tr>
						<tr>
							<td colspan="4">
								<div class="w3-medium">
									Araç Serviste Mi?&nbsp;&nbsp;&nbsp;
									<input type="checkbox" id="inpSwAracInService" name="inpSwAracInService" style="width: 18px;height: 18px;margin-top:3px" @(Model.SwAracInService == true ? "checked" : "") />
									&nbsp;&nbsp;&nbsp;
									<u class="w3-right" style="cursor:pointer" id="spanAracTeslimLogs">Geçmişi Gör</u>
								</div>
							</td>
						</tr>
					</tbody>
				</table>

			</div>
			@if (Model.isEmri.IsEmriTipId != SahinRektefiyeSoln.Models.Parameters.ServiceBankoSatisIsEmriTipId)
			{
				<!--Araç Bilgileri-->
				<div class="w3-third w3-padding-right">
					<table class=" w3-striped w3-white" cellpadding="4" cellspacing="2" width="100%">
						<thead>
							<tr>
								<td colspan="100%" class="w3-center w3-round w3-blue">
									Araç Bilgileri &nbsp;

									<span title="Araç geçmişini görüntülemek için tıklayınız" style="cursor: pointer;" id="btnVehicleHistory"><i class="fa fa-history w3-hover-opacity" aria-hidden="true"></i></span>
								</td>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td colspan="2">@Model.isEmri.Arac.Companies.Name</td>
								<td colspan="2">@Model.isEmri.Arac.Vehicles.Name</td>
							</tr>
							<tr>
								<td colspan="2">
									@Model.isEmri.Arac.AracModelAdi
								</td>
								<td colspan="2">
									Yakıt Tipi : @(Model.isEmri.Arac.YakitTipi != null ? Model.isEmri.Arac.YakitTipi.Aciklamasi : "")
								</td>
							</tr>
							<tr>
								<td>Şasi No</td>
								<td>@Model.isEmri.Arac.SaseNo</td>
								<td>Plaka</td>
								<td><b>@Model.isEmri.Arac.Plaka</b></td>
							</tr>
							<tr>
								<td>Km</td>
								<td>
									<style>
										#inputKm {
											background: transparent;
											border: none;
										}
									</style>
									<input id="inputKm" class="w3-hover-white w3-round w3-padding-left" type="text" value="@Model.isEmri.Arac.Km" oldKmValue="@Model.isEmri.Arac.Km" />
									@**@

								</td>
								<td>Model Yılı</td>
								<td>@Model.isEmri.Arac.ModelYili</td>
							</tr>
							<tr>
								<td colspan="2">Trafik Çıkış Trh : @(Model.isEmri.Arac.AracDetay.TrafigeCikisTarihi.HasValue == true ? Model.isEmri.Arac.AracDetay.TrafigeCikisTarihi.Value.ToShortDateString() : "Belirtilmemiş")</td>
								<td colspan="2">
									Renk :
									@if (Model.isEmri.Arac.Renkler != null)
									{
										<label>@Model.isEmri.Arac.Renkler.Aciklamasi</label>
									}
									else
									{
										<label></label>
									}

								</td>
							</tr>
							<tr>
								<td colspan="2">Egzos Muayne Baş/Bit Trh.</td>
								<td colspan="2">
									@(Model.isEmri.Arac.AracDetay.EgsozMuayeneBsgTrh.HasValue == true ? Model.isEmri.Arac.AracDetay.EgsozMuayeneBsgTrh.Value.ToShortDateString() : " ")
									-
									@(Model.isEmri.Arac.AracDetay.EgsozMuayeneBtsTrh.HasValue == true ? Model.isEmri.Arac.AracDetay.EgsozMuayeneBtsTrh.Value.ToShortDateString() : " ")
								</td>
							</tr>
							<tr>
								<td colspan="2">Muayene Baş/Bit Trh.</td>
								<td colspan="2">
									@(Model.isEmri.Arac.AracDetay.MuayeneBsgTrh.HasValue == true ? Model.isEmri.Arac.AracDetay.MuayeneBsgTrh.Value.ToShortDateString() : " ")
									-
									@(Model.isEmri.Arac.AracDetay.MuayeneBtsTrh.HasValue == true ? Model.isEmri.Arac.AracDetay.MuayeneBtsTrh.Value.ToShortDateString() : " ")
								</td>
							</tr>
						</tbody>
					</table>

				</div>
			}

			<!--Müşteri Bilgileri-->
			<div class="w3-third w3-padding-right">
				<table class=" w3-striped w3-white" cellpadding="4" cellspacing="2" width="100%">
					<thead>
						<tr>
							<td colspan="100%" class="w3-center w3-round w3-blue">
								Müşteri Bilgileri &nbsp;
								<a href="/Musteri/MusteriDuzenle?MusteriId=@Model.isEmri.Musteri.MusteriId"><span title="Müşteriye gitmek için tıklayınız" style="cursor: pointer;"><i class="fa fa-user-circle-o  w3-hover-opacity" aria-hidden="true"></i></span></a>
							</td>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td colspan="4" class="w3-center">
								<b>@MusteriDesc</b>
							</td>
						</tr>
						<tr>
							<td>
								Telefon
							</td>
							<td>
								@if (Model.isEmri.Musteri.MusteriTelefon.Count > 0)
								{
									<label>@Model.isEmri.Musteri.MusteriTelefon.FirstOrDefault().TelefonNumarasi</label>
								}
								else
								{
									<label>-</label>
								}
							</td>
							<td>Muhasebe Kodu</td>
							<td>@Model.isEmri.Musteri.MuhasebeKodu</td>
						</tr>
						<tr>

							<td>Tc/Vergi No</td>
							<td>
								@if (Model.isEmri.Musteri.MusteriTipi == "B")
								{
									<label>@Model.isEmri.Musteri.TCKN</label>
								}
								else
								{
									<label>@Model.isEmri.Musteri.VergiNo</label>
								}

							</td>
							<td>
								Vergi Dairesi
							</td>
							<td>
								@(Model.isEmri.Musteri.iller1 != null ? Model.isEmri.Musteri.iller1.sehir : "")
							</td>

						</tr>
						<tr>

							<td>İletişim İzni</td>
							<td colspan="3">
								Sms &nbsp; <i class="fa @(SwSms== false ? "fa-times-circle w3-text-red" : "fa-check-circle w3-text-green") w3-large" aria-hidden="true"></i> &nbsp;
								Arama &nbsp; <i class="fa @(SwArama== false ? "fa-times-circle w3-text-red" : "fa-check-circle w3-text-green") w3-large" aria-hidden="true"></i>&nbsp;
								Mail &nbsp;  <i class="fa @(SwMail== false ? "fa-times-circle w3-text-red" : "fa-check-circle w3-text-green") w3-large" aria-hidden="true"></i>

							</td>
						</tr>
						<tr>
							<td colspan="4">
								Adres : @Model.isEmri.Musteri.Adres
							</td>

						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<!--######### İş Emri Belirti Kodları #########-->
		@if (Model.isEmri.IsEmriTipId != SahinRektefiyeSoln.Models.Parameters.ServiceBankoSatisIsEmriTipId)
		{
			using (Html.BeginForm("IsEmriBelirtiKoduEkle", "IsEmri", FormMethod.Post))
			{
				<input type="hidden" name="IsEmri2Id" value="@Model.isEmri.IsEmriId" />
				<div class="w3-row">
					<div class="w3-quarter">
						<div class="w3-threequarter">
							<label>Belirti Kodu</label>
							@Html.DropDownList("BelirtiKodId", (SelectList)ViewBag.BelirtiKodlari, htmlAttributes: new { @class = "w3-select w3-border", @Id = "BelirtiKodId", name = "BelirtiKodId" })
						</div>
						<div class="w3-quarter">
							<br />
							<button type="submit" class="w3-button w3-border w3-green w3-block" id="btnBelirtiKoduEkle">Ekle</button>
						</div>
					</div>
					<div class="w3-threequarter">
						@if (Model.isEmri.IsEmriBelirtiKodlari.Any())
						{
							<br />
							foreach (var belirtiKod in Model.isEmri.IsEmriBelirtiKodlari)
							{
								<span class="w3-tag w3-blue w3-margin-left" style="margin-top:8px!important;">@belirtiKod.IsEmriTipAciklamasi</span>
							}
						}
					</div>

				</div>
			}
		}
		<!--######### İş Emri Notları #########-->
		<div class="w3-row w3-padding-top w3-padding-bottom">
			@using (Html.BeginForm("IsEmriNotEkle", "IsEmri", FormMethod.Post))
			{
				<input type="hidden" name="IsEmriId" value="@Model.isEmri.IsEmriId" />
				<div class="w3-col m11 l11">
					@Html.TextAreaFor(model => model.isEmri.Notlar, new { @class = "w3-input w3-border w3-round", maxlength = "1024", @placeholder = "Buraya İş Emri Notları Ekleyebilirsiniz..", autocomplete = "off", name = "Not" })
				</div>
				<div class="w3-col m1 l1 w3-padding">
					<button type="submit" class="w3-button w3-green" id="btnIsEmriNotEkle">Ekle</button>
				</div>
			}

		</div>
		<!--######### İş Emri Müşteri İstek ve Dosyalar #########-->
		<div class="w3-row">
			<div class="w3-third w3-padding-top w3-padding-right">
				<div class="w3-row">
					@using (Html.BeginForm("IsEmriMusteriIstekEkle", "IsEmri", FormMethod.Post))
					{
						<input type="hidden" name="IsEmriId" value="@Model.isEmri.IsEmriId" />
						<input type="text" name="Istek" class="w3-input w3-threequarter w3-border" id="txtMusteriIstek" placeholder="Müşteri İsteklerini ekleyin.." />
						<button type="submit" class="w3-button w3-quarter w3-green w3-block" id="btnMusteriIstekEkle">Ekle</button>
					}

				</div>
				@if (3 > 0)
				{
					<div class="w3-row">
						<ul class="w3-ul w3-border">
							@foreach (var istek in Model.isEmri.IsEmriMusteriIstekleri)
							{
								<li>
									<a href="/IsEmri/IsEmriMusteriIstekSil?IsEmriMusteriIstekId=@istek.IsEmriMusteriIstekId" title="İsteği silmek için tıklayın..."><i class="fa fa-times" aria-hidden="true"></i></a>
									@musteriIstekCount - @istek.Istek
								</li>

								musteriIstekCount += 1;

							}
						</ul>
					</div>
				}
			</div>
			<div class="w3-twothird w3-padding-top">
				<div class="w3-half w3-padding-bottom w3-round w3-padding-right">
					@using (Html.BeginForm("IsEmriDosyaEkle", "IsEmri", FormMethod.Post, new { enctype = "multipart/form-data" }))
					{
						<div class="w3-row" style="border-style: dashed;position: relative;">

							<input type="hidden" name="IsEmriId" value="@Model.isEmri.IsEmriId" />
							@Html.AntiForgeryToken()
							<div class="image-upload-wrap" style="display: block;">
								<input type="file" id="fileInputhdn" accept="image/png, image/jpeg" name="files" class="file-upload-input" multiple="">
								<div class="drag-text">
									<h3>İş Emrine dosya eklemek için buraya sürükleyin.</h3>
								</div>
							</div>
							<div class="w3-center">

								<div class="w3-display-container">
									<div class="w3-display-topright  ">
										<span id="btnClear" class="w3-margin-right w3-hide"><i class="fa fa-times" aria-hidden="true"></i> </span>
									</div>
									<div id="WorkOrderImagesList"></div>
									<img id="blah" src="" alt="" class="w3-quarter w3-padding w3-center w3-hide" onclick="onClick(this)">
								</div>

							</div>


						</div>
						<button type="submit" class=" w3-green w3-btn w3-round w3-block" value="btnDosyaEkle" id="btnDosyaEkle" name="submitButton">Seçili Dosyaları Ekle</button>}
				</div>
				<div class="w3-half ">
					<table class="w3-table-all">
						<thead>
							<tr>
								<th colspan="3">Araç Dosyaları ( @Model.isEmri.IsEmriDosyalari.Count dosya eklenmiş.)</th>
							</tr>
						</thead>
						<tbody>
							@foreach (var dosya in Model.isEmri.IsEmriDosyalari.Where(x => x.IsEmriTipId == null).Take(3))
							{
								<tr>
									<td>
										<img src="@dosya.DosyaUrl" class="w3-hover-opacity aracDosyasi" title="@dosya.CreatedDate.ToShortDateString() tarihinde eklendi." width="50" height="50">
									</td>
									<td><a href="/IsEmri/IsEmriDosyaSil?IsEmriDosyaId=@dosya.IsEmriDosyaId" class="w3-btn w3-red"> Sil</a></td>
									<td><a href="@dosya.DosyaUrl" class="w3-btn w3-blue" download> Dosyayı İndir</a></td>
								</tr>
							}
						</tbody>
						@if (Model.isEmri.IsEmriDosyalari.Count > 3)
						{

							<tr>
								<td colspan="3"><button onclick="document.getElementById('ModelIsEmriDosyalari').style.display = 'block'; return false;" class="w3-button w3-green w3-block">Diğer Dosyaları görmek için tıklayınız</button></td>
							</tr>

						}
					</table>
				</div>
			</div>
		</div>

		@if (Model.isEmri.IsEmriTipId != SahinRektefiyeSoln.Models.Parameters.ServiceBankoSatisIsEmriTipId)
		{
			<div class="w3-half">
				@if (isEmriGunlukIds.Contains(Model.isEmri.IsEmriTipId))
				{
					<div class="w3-half"><b>Seri No : @Model.isEmri.SerialNo</b></div>
					<div class="w3-half"><b>Parça No : @Model.isEmri.PartNo</b></div>
				}
			</div>
		}
		<!--######### Tespitler-->
		@if (isEmriGunlukIds.Contains(Model.isEmri.IsEmriTipId))
		{
			Html.RenderAction("GetTespitler", "IsEmri", new { isEmriId = Model.isEmri.IsEmriId });
		}
		<!--######### İş Emri Kalemleri #########-->
		<div class="w3-row w3-margin-bottom ">
			<div class="w3-row">
				<div class="w3-threequarter">
					<h5>İŞÇİLİK ve PARÇA DETAYI</h5>
				</div>

			</div>
			<div class="w3-section">
				<button class="w3-btn w3-ripple w3-blue" id="btnIsEmriIscilikEkle"><i class="fa fa-plus" aria-hidden="true"></i> İşçilik</button>
				<button class="w3-btn w3-ripple w3-blue" id="btnDyiEkle"><i class="fa fa-plus" aria-hidden="true"></i> DYI</button>
				@*<button class="w3-btn w3-ripple w3-blue" id="btnIsEmriParcaEkle"><i class="fa fa-plus" aria-hidden="true"></i> Parça</button>*@
				<button class="w3-btn w3-ripple w3-blue" id="btnIsEmriParcaEkleNew"><i class="fa fa-plus" aria-hidden="true"></i> Parça</button>
				<button class="w3-btn w3-ripple w3-blue" id="btnIskontoEkle"><i class="fa fa-plus" aria-hidden="true"></i> Genel İskonto</button>
				<button class="w3-btn w3-ripple w3-blue" id="btnIsEmriPaketEkle"><i class="fa fa-plus" aria-hidden="true"></i> Bakım/Tamir Paketleri</button>
				<button class="w3-btn w3-ripple w3-red " id="btnSecimleriSil"><i class="fa fa-times w3-text-white" aria-hidden="true"></i> Seçilenleri Sil</button>

				@if (KonsinyeVarmi)
				{
					<button class="w3-btn w3-ripple w3-teal " id="btnStokAl"><i class="fa-arrow-circle-right w3-text-white" aria-hidden="true"></i> Stok Al</button>
				}


				@*<a href="/IsEmri/IsEmriKapat?IsEmriId=@Model.isEmri.IsEmriId" class="w3-btn w3-ripple w3-green w3-right" id="btnIsEmriKapat"><i class="fa fa-check-square-o w3-text-white" aria-hidden="true"></i> İş Emrini Kapat</a>*@
				@*<a href="/IsEmri/IsEmriniMuhasebeyeGonder?IsEmriId=@Model.isEmri.IsEmriId" class="w3-btn w3-ripple w3-green w3-right" id="btnIsEmriKapat"><i class="fa fa-check-square-o w3-text-white" aria-hidden="true"></i> Faturala </a>*@


				<button class="w3-btn w3-ripple w3-green w3-right" id="btnIsEmriniMuhasebeyeGonder"><i class="fa fa-check-square-o w3-text-white" aria-hidden="true"></i> Faturala  </button>

				<button class="w3-btn w3-ripple w3-red w3-right" id="btnIsEmriIptalEt"><i class="fa fa-times w3-text-white" aria-hidden="true"></i> İş Emrini İptal / İade</button>
				@if (ViewBag.StokYetkilisi)
				{
					<button class="w3-btn w3-ripple w3-blue w3-right" id="btnParcalariTeslimEt"><i class="fa fa-check-square-o w3-text-white" aria-hidden="true"></i> Parçaları Teslim Et</button>
				}

			</div>
			<div class="w3-row">
				<div class="w3-padding w3-panel">
					<table class="w3-table-all w3-margin-top w3-margin-bottom" id="tableIsEmriKalemleri">
						<thead>
							<tr>
								<td>#</td>
								<td>#</td>
								<td>#</td>
								<td>Tip</td>
								<td>Konsinye</td>
								<td>İş/Parça No</td>
								<td>İş/Parça Adı</td>
								<td>Adet/Saat</td>
								<td>Kdv Hariç Birim Fiyat</td>
								<td>İskonto %</td>
								<td>İskonto Tutarı</td>
								<td>KDVsiz İskontolu Birim Fiyat</td>
								<td>KDV Oranı</td>
								@*<td>KDV Tutarı</td>*@
								<td>KDVli Birim Fiyat</td>
								<td>T.KDV Tutarı</td>
								<td>Kdv Hariç Tutar</td>
							</tr>
						</thead>
						<tbody>
							@if (Model.isEmriKalemleri.Count > 0)
							{
								foreach (var kalem in Model.isEmriKalemleri.Where(x => x.KalepTipi == "I" && x.IsEmriTipId == null))
								{
									<tr>
										<td>
											@kalemCounter
										</td>
										<td>
											<input type="checkbox" class="kalemWillDelete" KalemId="@kalem.IsEmriKalemId" />
										</td>
										<td>
											@if (Model.isEmri.IsEmriStatuId != SahinRektefiyeSoln.Models.Parameters.IsEmriIptalStatu)
											{
												<a href="/IsEmri/IsEmriKalemSil?IsEmriKalemId=@kalem.IsEmriKalemId" title="İş emrinden kalemi silmek için tıklayınız." class="w3-text-red aisEmriIptalLine"><i class="fa fa-times-circle-o w3-hover-opacity" aria-hidden="true"></i></a>
											}
											else
											{
												<button href="/IsEmri/IsEmriKalemSil?IsEmriKalemId=@kalem.IsEmriKalemId" title="İş emrinden kalemi silmek için tıklayınız." class="w3-text-red aisEmriIptalLine"><i class="fa fa-times-circle-o w3-hover-opacity" aria-hidden="true"></i></button>
											}
										</td>
										<td>İşçilik</td>
										<td>@*<input type="checkbox" disabled />*@</td>
										<td>@kalem.IscilikKodu</td>
										<td>@kalem.IscilikAdi</td>
										<td>@String.Format("{0:0.00}", kalem.Miktar)</td>
										<td>
											@if (kalem.isDYI)
											{
												<label>@String.Format("{0:0.00}", kalem.kdvHaricBirimFiyati)</label>
											}
											else
											{
												<label>@String.Format("{0:0.00}", kalem.kdvHaricBirimFiyati)</label>
											}
										</td>
										<td>
											<a title="Kalem İstonto Oranı girmek için tıklayın" class="w3-text-red btnkalemIskonto w3-right" IsEmriKalemId="@kalem.IsEmriKalemId"><i class="fa fa-cart-arrow-down w3-hover-opacity" aria-hidden="true"></i></a>
											<label class="w3-left">@String.Format("{0:0.00}", kalem.kalemIskontoOrani * 100) </label>
										</td>
										<td>@String.Format("{0:0.00}", kalem.kalemIskontoTutari)</td>
										<td>@String.Format("{0:0.00}", kalem.KdvHaricIskontoluBFiyat)</td>
										<td>@String.Format("{0:0.00}", kalem.KdvOrani * 100)</td>
										<td>@String.Format("{0:0.00}", kalem.KdvDahilBirimFiyat)</td>
										<td>@String.Format("{0:0.00}", kalem.ToplamKdvliTutari)</td>
										<td>@String.Format("{0:0.00}", kalem.KdvHaricTutar)</td>
									</tr>
									kalemCounter += 1;
								}
								foreach (var kalem in Model.isEmriKalemleri.Where(x => x.KalepTipi == "P" && x.IsEmriTipId == null))
								{
									<tr>
										<td>
											@kalemCounter
										</td>
										<td>
											<input type="checkbox" class="kalemWillDelete" KalemId="@kalem.IsEmriKalemId" />
										</td>
										<td>
											@if (Model.isEmri.IsEmriStatuId != SahinRektefiyeSoln.Models.Parameters.IsEmriIptalStatu)
											{
												<a href="/IsEmri/IsEmriKalemSil?IsEmriKalemId=@kalem.IsEmriKalemId" title="İş emrinden kalemi silmek için tıklayınız." class="w3-text-red aisEmriIptalLine"><i class="fa fa-times-circle-o w3-hover-opacity" aria-hidden="true"></i></a>
											}
											else
											{
												<button href="/IsEmri/IsEmriKalemSil?IsEmriKalemId=@kalem.IsEmriKalemId" title="İş emrinden kalemi silmek için tıklayınız." class="w3-text-red aisEmriIptalLine"><i class="fa fa-times-circle-o w3-hover-opacity" aria-hidden="true"></i></button>
											}
										</td>
										<td>Parça</td>
										<td><input type="checkbox" class="w3-margin-left w3-check" style="width:20px!important;height:20px!important" @(kalem.IsKonsinye == true ? "checked" : "") disabled /></td>
										<td>@kalem.ParcaNo</td>
										<td>@kalem.ParcaAdi</td>
										<td>
											<a onclick="document.getElementById('depoParcaTeslim-@kalem.IsEmriKalemId').style.display='block'" class="w3-hover-opacity" style="cursor: pointer;" title="Parça Teslim Durumunu Görüntülemek İçin Tıklayınız..">@kalem.Miktar</a>
											<div id="depoParcaTeslim-@kalem.IsEmriKalemId" class="w3-modal">
												<div class="w3-modal-content">
													<div class="w3-container">
														<span onclick="document.getElementById('depoParcaTeslim-@kalem.IsEmriKalemId').style.display='none'" class="w3-button w3-display-topright">&times;</span>
														<div class="w3-row w3-center">
															<p>@kalem.ParcaNo - @kalem.ParcaAdi parçasından @kalem.TeslimEdilenMiktar adet/miktar teslim edilmiştir</p>

														</div>
													</div>
												</div>
											</div>
										</td>
										<td>@String.Format("{0:0.00}", kalem.kdvHaricBirimFiyati)</td>
										<td>
											<a title="Kalem İstonto Oranı girmek için tıklayın" class="w3-text-red btnkalemIskonto w3-right" IsEmriKalemId="@kalem.IsEmriKalemId"><i class="fa fa-cart-arrow-down w3-hover-opacity" aria-hidden="true"></i></a>
											<label class="w3-left">@(kalem.kalemIskontoOrani * 100)</label>
										</td>
										<td>@String.Format("{0:0.00}", kalem.kalemIskontoTutari)</td>
										<td>@String.Format("{0:0.00}", kalem.KdvHaricIskontoluBFiyat)</td>
										<td>@String.Format("{0:0.00}", kalem.KdvOrani * 100)</td>
										@*<td>@String.Format("{0:0.00}",kalem.KdvBirimTutari)</td>*@
										<td>@String.Format("{0:0.00}", kalem.KdvDahilBirimFiyat)</td>
										<td>@String.Format("{0:0.00}", kalem.ToplamKdvliTutari)</td>
										<td>@String.Format("{0:0.00}", kalem.KdvHaricTutar)</td>
									</tr>
									kalemCounter += 1;
								}
							}
							else
							{
								<tr>
									<td class="w3-center w3-text-red" colspan="13"> <b>İŞ EMRİNE PARÇA VEYA İŞÇİLİK EKLENMEMİŞTİR. </b></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
									<td style="display:none;"></td>
								</tr>
							}
						</tbody>
						<tfoot>
							<tr>
								<th colspan="15" style="text-align:right">Toplam:</th>
								<th></th>
							</tr>
						</tfoot>
					</table>

					<table id="tableofParts" style="opacity:0;position:absolute;z-index:-1">
						@foreach (var item in Model.isEmriKalemleri.Where(x => x.KalepTipi == "I"))
						{
							<tr>
								@*<td>@(item.IscilikKodu)</td>*@
								<td>@(item.IscilikAdi)</td>
								<td>@(String.Format("{0:0.00}", item.Miktar)) </td>
								<td>@(String.Format("{0:0.00}", item.kdvHaricBirimFiyati))</td>
							</tr>
						}
						@foreach (var item in Model.isEmriKalemleri.Where(x => x.KalepTipi == "P"))
						{
							<tr>
								@*<td>@(item.ParcaNo)</td>*@
								<td>@(item.ParcaAdi)</td>
								<td>@(String.Format("{0:0.00}", item.Miktar)) </td>
								<td>@(String.Format("{0:0.00}", item.kdvHaricBirimFiyati))</td>
							</tr>
						}
					</table>
				</div>
			</div>

		</div>

		@*<style>
				.collapsible {
					cursor: pointer;
					width: 100%;
					outline: none;
				}

				.active, .collapsible:hover {
					background-color: #555;
				}

				.content {
					max-height: 0;
					overflow: hidden;
					transition: max-height 0.2s ease-out;
				}
			</style>*@


		<!--######### İş Emri Belirti Kodları Foreach #########-->

		@foreach (var belirtiKodu in Model.isEmri.IsEmriBelirtiKodlari)
		{
			<div class="w3-border w3-border-blue w3-margin">
				<!--######### İş Emri Belirti HEADER #########-->
				<div class="w3-panel w3-blue w3-round collapsible" style="margin-top: 0px;font-family:Arial;margin-bottom:0px!important">
					<div class="w3-half">
						<div class="w3-left">
							<p><b>BELİRTİ KODU : </b>@belirtiKodu.IsEmriTipAciklamasi Giriş Tarihi: @(belirtiKodu.BelirtiKodTarihi.Value.ToShortDateString()) - @(belirtiKodu.BelirtiKodTarihi.Value.ToShortTimeString()) </p>

						</div>
					</div>
					<div class="w3-quarter">
						<label>  </label>
					</div>
					<div class="w3-half w3-right">
						<div class="w3-right w3-margin-top">

							@*@if (isEmriGunlukIds.Contains(Model.isEmri.IsEmriTipId))
								{*@
							<span style="cursor:alias"><i class="fa fa-file-word-o" aria-hidden="true" onclick="onDownloadGunlukDocument('@belirtiKodu.IsEmriTipId');"></i></span>
							<span style="cursor:alias"><i class="fa fa-file-pdf-o " aria-hidden="true" onclick="onPdfGunlukExport('@belirtiKodu.IsEmriTipId');"></i></span>
							<span style="cursor:alias"><i class="fa  fa-print" aria-hidden="true" onclick="onPrintGunlukClick('@belirtiKodu.IsEmriTipId');"></i></span>
							@* } *@

							@*<span class="w3-right w3-padding-lr-4" style="cursor:alias" title="İş Emri Dökümünü Yazdır"> &nbsp;<i class="fa fa-print w3-text-green" aria-hidden="true" onclick="onIsEmriExport();"></i></span>
								<span class="w3-right" style="cursor:alias" title="İş Emrini Yazdır"> &nbsp;<i class="fa fa-print w3-text-blue" aria-hidden="true" onclick="onPdfExport();"></i></span>*@
							<span class="w3-right" style="cursor:alias" title="Kalite Formu Yazdır"> &nbsp;<img src="~/Images/quality-icon-20.jpg" onclick="onKaliteFormExport();" width="13" height="13" /></span>


						</div>
					</div>
				</div>
				<!--######### İş Emri Belirti HEADER #########-->
				<div class="content">
					<!--######### İş Emri Belirti SeriNo&PartNo&Açıklama&Resim #########-->
					<div class="w3-row" style="margin-top:8px!important">
						<div class="w3-half w3-padding-left">
							<div class="w3-row" asdf="asdfsadf">
								<div class="w3-half w3-padding-right">
									<label>Seri No</label>
									<input autocomplete="off" class="w3-input w3-border w3-round BelirtiKoduSeriNoGuncelle" BelirtiKodu="@belirtiKodu.IsEmriTipId" id="" maxlength="24" name="" type="text" value="@belirtiKodu.SeriNo">
								</div>
								<div class="w3-half">
									<label>Parça No</label>
									<input autocomplete="off" class="w3-input w3-border w3-round BelirtiKoduPartNoGuncelle" BelirtiKodu="@belirtiKodu.IsEmriTipId" id="" maxlength="24" name="" type="text" value="@belirtiKodu.PartNo">
								</div>
							</div>

							<div class="w3-row w3-margin-top">
								<textarea autocomplete="off" class="w3-input w3-border w3-round BelirtiKoduAciklamaGuncelle" BelirtiKodu="@belirtiKodu.IsEmriTipId" cols="20" id="isEmri_Notlar" maxlength="2048" placeholder="Buraya @belirtiKodu.IsEmriTipAciklamasi ile alakalı Notları Ekleyebilirsiniz.." rows="4">@belirtiKodu.Notlar</textarea>
							</div>

						</div>
						<!--######### İş Emri Belirti PartNo #########-->
						<!--######### İş Emri Belirti Notlar #########-->
						<div class="w3-half w3-padding-left">
							@using (Html.BeginForm("IsEmriDosyaEkle", "IsEmri", FormMethod.Post, new { enctype = "multipart/form-data" }))
							{
								@Html.AntiForgeryToken()
								<div class="w3-row">
									<div class="w3-half">
										<input type="hidden" name="IsEmriId" value="@Model.isEmri.IsEmriId" />
										<input type="hidden" name="BelirtiKodId" value="@belirtiKodu.IsEmriTipId" />
										<br />
										<input type="file" id="file" name="files" accept="image/png, image/jpeg" multiple>
									</div>
									<div class="w3-half w3-left">
										<br />
										<button type="submit" class="w3-left w3-green w3-btn w3-round ">Seçili Dosyaları Ekle</button>
									</div>
								</div>


							}
							<table>
								<!-- TODO : ISEMRIDOSYALARI İSEMRİTİİPİNE GÖRE GELECEK ! -->
								@foreach (var dosya in Model.isEmri.IsEmriDosyalari.Where(x => x.IsEmriTipId == belirtiKodu.IsEmriTipId))
								{
									<tr>

										<td>
											<img src="@dosya.DosyaUrl" class="w3-hover-opacity aracDosyasi" title="@dosya.CreatedDate.ToShortDateString() tarihinde eklendi." width="50" height="50">
										</td>
										<td><a href="/IsEmri/IsEmriDosyaSil?IsEmriDosyaId=@dosya.IsEmriDosyaId" class="w3-btn w3-red"> Sil</a></td>
										<td><a href="@dosya.DosyaUrl" class="w3-btn w3-blue" download> Dosyayı İndir</a></td>
									</tr>
								}
							</table>
						</div>
						<!--######### İş Emri Belirti Notlar #########-->
						<div class="w3-row w3-padding-top">

							@{Html.RenderAction("GetTespitlerBelirtiKoduIle", "IsEmri", new { IsEmriBelirtiKodlariId = belirtiKodu.IsEmriBelirtiKodlariId });}

						</div>
					</div>
					<!--######### İş Emri Belirti SeriNo&PartNo&Açıklama&Resim #########-->

					<div class="w3-row w3-padding">
						<h6>İŞÇİLİK ve PARÇA DETAYI</h6>
						<button class="w3-btn w3-ripple w3-blue btnIscilikWithBelirtiKodu" BelirtiKodu="@belirtiKodu.IsEmriTipId"><i class="fa fa-plus" aria-hidden="true"></i> İşçilik</button>
						<button class="w3-btn w3-ripple w3-blue btnDyiEkleWithBelirtiKodu" BelirtiKodu="@belirtiKodu.IsEmriTipId"><i class="fa fa-plus" aria-hidden="true"></i> DYI</button>
						<button class="w3-btn w3-ripple w3-blue btnIsEmriParcaEkleWithBelirtiKodu" BelirtiKodu="@belirtiKodu.IsEmriTipId"><i class="fa fa-plus" aria-hidden="true"></i> Parça</button>
						<button class="w3-btn w3-ripple w3-blue btnIskontoEkleWithBelirtiKodu" BelirtiKodu="@belirtiKodu.IsEmriTipId"><i class="fa fa-plus" aria-hidden="true"></i> Genel İskonto</button>
						<button class="w3-btn w3-ripple w3-blue btnIsEmriPaketEkleWihtBelirtiKodu" BelirtiKodu="@belirtiKodu.IsEmriTipId"><i class="fa fa-plus" aria-hidden="true"></i> Bakım/Tamir Paketleri</button>
						<button class="w3-btn w3-ripple w3-red  btnSecimleriSil" BelirtiKodu="@belirtiKodu.IsEmriTipId"><i class="fa fa-times w3-text-white" aria-hidden="true"></i> Seçilenleri Sil</button>
					</div>

					<div class="w3-row w3-padding  w3-panel">
						<table class="w3-table-all w3-margin-top w3-margin-bottom" id="tableIsEmriKalemleri@(belirtiKodu.IsEmriTipId)">
							<thead>
								<tr>
									<td>#</td>
									<td>#</td>
									<td>#</td>
									<td>Tip</td>
									<td>İş/Parça No</td>
									<td>İş/Parça Adı</td>
									<td>Adet/Saat</td>
									<td>Kdv Hariç Birim Fiyat</td>
									<td>İskonto %</td>
									<td>İskonto Tutarı</td>
									<td>KDVsiz İskontolu Birim Fiyat</td>
									<td>KDV Oranı</td>
									<td>KDVli Birim Fiyat</td>
									<td>T.KDV Tutarı</td>
									<td>Kdv Hariç Tutar</td>
								</tr>
							</thead>
							<tbody>
								@if (Model.isEmriKalemleri.Where(x => x.IsEmriTipId == belirtiKodu.IsEmriTipId).Count() > 0)
								{
									foreach (var kalem in Model.isEmriKalemleri.Where(x => x.KalepTipi == "I" && x.IsEmriTipId == belirtiKodu.IsEmriTipId))
									{
										<tr>
											<td>
												@kalemCounter
											</td>
											<td>
												<input type="checkbox" class="kalemWillDelete@(belirtiKodu.IsEmriTipId)" KalemId="@kalem.IsEmriKalemId" />
											</td>
											<td>
												@if (Model.isEmri.IsEmriStatuId != SahinRektefiyeSoln.Models.Parameters.IsEmriIptalStatu)
												{
													<a href="/IsEmri/IsEmriKalemSil?IsEmriKalemId=@kalem.IsEmriKalemId" title="İş emrinden kalemi silmek için tıklayınız." class="w3-text-red aisEmriIptalLine"><i class="fa fa-times-circle-o w3-hover-opacity" aria-hidden="true"></i></a>
												}
												else
												{
													<button href="/IsEmri/IsEmriKalemSil?IsEmriKalemId=@kalem.IsEmriKalemId" title="İş emrinden kalemi silmek için tıklayınız." class="w3-text-red aisEmriIptalLine"><i class="fa fa-times-circle-o w3-hover-opacity" aria-hidden="true"></i></button>
												}
											</td>
											<td>İşçilik</td>
											<td>@kalem.IscilikKodu</td>
											<td>@kalem.IscilikAdi</td>
											<td>@String.Format("{0:0.00}", kalem.Miktar)</td>
											<td>
												@if (kalem.isDYI)
												{
													<label>@String.Format("{0:0.00}", kalem.kdvHaricBirimFiyati)</label>
												}
												else
												{
													<label>@String.Format("{0:0.00}", kalem.kdvHaricBirimFiyati)</label>
												}
											</td>
											<td>
												<a title="Kalem İstonto Oranı girmek için tıklayın" class="w3-text-red btnkalemIskonto w3-right" IsEmriKalemId="@kalem.IsEmriKalemId"><i class="fa fa-cart-arrow-down w3-hover-opacity" aria-hidden="true"></i></a>
												<label class="w3-left">@String.Format("{0:0.00}", kalem.kalemIskontoOrani * 100) </label>
											</td>
											<td>@String.Format("{0:0.00}", kalem.kalemIskontoTutari)</td>
											<td>@String.Format("{0:0.00}", kalem.KdvHaricIskontoluBFiyat)</td>
											<td>@String.Format("{0:0.00}", kalem.KdvOrani * 100)</td>
											<td>@String.Format("{0:0.00}", kalem.KdvDahilBirimFiyat)</td>
											<td>@String.Format("{0:0.00}", kalem.ToplamKdvliTutari)</td>
											<td>@String.Format("{0:0.00}", kalem.KdvHaricTutar)</td>
										</tr>
										kalemCounter += 1;
									}
									foreach (var kalem in Model.isEmriKalemleri.Where(x => x.KalepTipi == "P" && x.IsEmriTipId == belirtiKodu.IsEmriTipId))
									{
										<tr>
											<td>
												@kalemCounter
											</td>
											<td>
												<input type="checkbox" class="kalemWillDelete@(belirtiKodu.IsEmriTipId)" KalemId="@kalem.IsEmriKalemId" />
											</td>
											<td>
												@if (Model.isEmri.IsEmriStatuId != SahinRektefiyeSoln.Models.Parameters.IsEmriIptalStatu)
												{
													<a href="/IsEmri/IsEmriKalemSil?IsEmriKalemId=@kalem.IsEmriKalemId" title="İş emrinden kalemi silmek için tıklayınız." class="w3-text-red aisEmriIptalLine"><i class="fa fa-times-circle-o w3-hover-opacity" aria-hidden="true"></i></a>
												}
												else
												{
													<button href="/IsEmri/IsEmriKalemSil?IsEmriKalemId=@kalem.IsEmriKalemId" title="İş emrinden kalemi silmek için tıklayınız." class="w3-text-red aisEmriIptalLine"><i class="fa fa-times-circle-o w3-hover-opacity" aria-hidden="true"></i></button>
												}
											</td>
											<td>Parça</td>
											<td>@kalem.ParcaNo</td>
											<td>@kalem.ParcaAdi</td>
											<td>
												<a onclick="document.getElementById('depoParcaTeslim-@kalem.IsEmriKalemId').style.display='block'" class="w3-hover-opacity" style="cursor: pointer;" title="Parça Teslim Durumunu Görüntülemek İçin Tıklayınız..">@kalem.Miktar</a>
												<div id="depoParcaTeslim-@kalem.IsEmriKalemId" class="w3-modal">
													<div class="w3-modal-content">
														<div class="w3-container">
															<span onclick="document.getElementById('depoParcaTeslim-@kalem.IsEmriKalemId').style.display='none'" class="w3-button w3-display-topright">&times;</span>
															<div class="w3-row w3-center">
																<p>@kalem.ParcaNo - @kalem.ParcaAdi parçasından @kalem.TeslimEdilenMiktar adet/miktar teslim edilmiştir</p>

															</div>
														</div>
													</div>
												</div>
											</td>
											<td>@String.Format("{0:0.00}", kalem.kdvHaricBirimFiyati)</td>
											<td>
												<a title="Kalem İstonto Oranı girmek için tıklayın" class="w3-text-red btnkalemIskonto w3-right" IsEmriKalemId="@kalem.IsEmriKalemId"><i class="fa fa-cart-arrow-down w3-hover-opacity" aria-hidden="true"></i></a>
												<label class="w3-left">@(kalem.kalemIskontoOrani * 100)</label>
											</td>
											<td>@String.Format("{0:0.00}", kalem.kalemIskontoTutari)</td>
											<td>@String.Format("{0:0.00}", kalem.KdvHaricIskontoluBFiyat)</td>
											<td>@String.Format("{0:0.00}", kalem.KdvOrani * 100)</td>
											@*<td>@String.Format("{0:0.00}",kalem.KdvBirimTutari)</td>*@
											<td>@String.Format("{0:0.00}", kalem.KdvDahilBirimFiyat)</td>
											<td>@String.Format("{0:0.00}", kalem.ToplamKdvliTutari)</td>
											<td>@String.Format("{0:0.00}", kalem.KdvHaricTutar)</td>
										</tr>
										kalemCounter += 1;
									}
								}
								else
								{
									<tr>
										<td class="w3-center w3-text-red" colspan="13"> <b>İŞ EMRİNE PARÇA VEYA İŞÇİLİK EKLENMEMİŞTİR. </b></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
										<td style="display:none;"></td>
									</tr>
								}
							</tbody>
							<tfoot>
								<tr>
									<th colspan="14" style="text-align:right">Toplam:</th>
									<th></th>
								</tr>
							</tfoot>
						</table>

					</div>

				</div>

			</div>
		}

		<!--######### İş Emri Belirti Kodları Foreach #########-->
		<!--İş Emri Fiyat Bilgileri-->
		<div class="w3-row w3-margin w3-light-gray w3-round ">

			<div id="divIsEmriDetay">
				<div class="w3-quarter w3-right">

					<table class="w3-right">
						@*<tr>
								<td>İndirim Öncesi Tutar</td>
								<td class="w3-right"> <b>@(Math.Round(Convert.ToDecimal(ViewBag.IndirimsizTutar), 2))  ₺</b></td>
							</tr>*@
						<tr>
							<td>Toplam Müşteri</td>
							<td class="w3-right"><b>@String.Format("{0:0.00}", Model.isEmriKalemleri.Sum(x => x.KdvHaricTutar)) ₺ </b></td>
						</tr>
						<tr>
							<td>Kdv Tutarı</td>
							<td class="w3-right"><b>@String.Format("{0:0.00}", (Model.isEmriKalemleri.Sum(x => x.ToplamKdvliTutari))) ₺</b></td>
						</tr>
						<tr>
							<td>Kdv'li Toplam </td>
							<td class="w3-right"><b>@String.Format("{0:0.00}", (Model.isEmriKalemleri.Sum(x => x.ToplamKdvliTutari) + Model.isEmriKalemleri.Sum(x => x.KdvHaricTutar))) ₺</b></td>
						</tr>
					</table>

				</div>
				<div class="w3-quarter w3-right">
					<table class="w3-right">
						<tr>
							<td width="50%">Parça Satır</td>
							<td class="w3-right"><b>@String.Format("{0:0.00}", Model.isEmriKalemleri.Where(x => x.KalepTipi == "P").Count())</b></td>
						</tr>
						<tr>
							<td>Toplam Parça</td>
							<td class="w3-right"><b> @String.Format("{0:0.00}", Model.isEmriKalemleri.Where(x => x.KalepTipi == "P").Sum(x => x.KdvHaricTutar)) ₺</b></td>
						</tr>
						<tr>
							<td>İşçilik Satır</td>
							<td class="w3-right"><b>@String.Format("{0:0.00}", Model.isEmriKalemleri.Where(x => x.KalepTipi == "I").Count()) </b></td>
						</tr>
						<tr>
							<td>Toplam İşçilik</td>
							<td class="w3-right"><b>@String.Format("{0:0.00}", Model.isEmriKalemleri.Where(x => x.KalepTipi == "I").Sum(x => x.KdvHaricTutar)) ₺</b></td>
						</tr>

					</table>
				</div>
				<div class="w3-half w3-left">
					@if (ViewBag.IsMuhasebe)
					{
						if (ViewBag.FaturaKesildiMi == 50)
						{
							<label>Fatura kesilmiştir.</label><br />
							<label>Muhasebe Notu : @Model.isEmri.MuhasebeNotu</label>
						}
						else
						{
							<div class="w3-row w3-margin-bottom w3-padding">
								Fatura Tipi :
								@switch (Model.isEmri.FaturaTipi)
								{
									case 10:
										<label>Normal Fatura</label>
										break;
									case 20:
										<label>Açık Fatura</label>
										break;
									default:
										<label>-</label>
										break;
								}
								<br />
								Muhasebe Notu : @Model.isEmri.MuhasebeNotu
							</div>
							<div class="w3-row w3-padding">
								<div class="w3-quarter w3-padding">
									<a href="#" class="w3-small w3-btn w3-ripple w3-blue w3-left w3-round w3-margin-right btnFaturaKes w3-block" faturaid="@ViewBag.faturaid" isemritipi="@ViewBag.isemritipi" isemriid="@Model.isEmri.IsEmriId" faturatipi="@ViewBag.faturatipi" displayisemri="@ViewBag.displayisemri">Fatura Kes</a>
								</div>
								<div class="w3-quarter w3-padding">
									<a href="/Invoice/ReturnWorkOrder?InvoiceId=@ViewBag.faturaid&WorkOrderId=@Model.isEmri.IsEmriId&Type=@ViewBag.isemritipi" class="w3-block w3-small w3-btn w3-ripple w3-red w3-left w3-round w3-margin-right w3-block" onclick="if (!confirm('Geri göndermek istediğinizden emin misiniz?')) return false;"> <i class="fa fa-undo" aria-hidden="true"></i> Geri Gönder </a>
								</div>


							</div>
						}

					}
				</div>

			</div>


		</div>

		@*<div class="w3-row w3-margin-bottom">
				<div class="w3-row w3-row-padding">
					<div class="w3-center w3-round w3-blue">Muhasebe İşlemleri</div>
				</div>
				<div class="w3-row w3-row-padding">
					asdf
				</div>
			</div>*@
	</div>



</div>
@*<script>
		var coll = document.getElementsByClassName("collapsible");
		var i;

		for (i = 0; i < coll.length; i++) {
			coll[i].addEventListener("click", function () {
				this.classList.toggle("active");
				var content = this.nextElementSibling;
				if (content.style.maxHeight) {
					content.style.maxHeight = null;
				} else {
					content.style.maxHeight = content.scrollHeight + "px";
				}
			});
		}
	</script>*@


<div id="ModelIsEmriDosyalari" class="w3-modal w3-animate-opacity">
	<div class="w3-modal-content w3-card-4">
		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('ModelIsEmriDosyalari').style.display='none'"
				  class="w3-button w3-large w3-display-topright">&times;</span>
			<h2>Tüm İş Emri Dosyaları</h2>
		</header>
		<div class="w3-container w3-padding ">
			<table class="w3-table-all">
				<thead>
					<tr>
						<th colspan="4">Araç Dosyaları ( @Model.isEmri.IsEmriDosyalari.Count dosya eklenmiş)</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var dosya in Model.isEmri.IsEmriDosyalari)
					{
						<tr>

							<td>
								<img src="@dosya.DosyaUrl" class="w3-hover-opacity aracDosyasi" title="@dosya.CreatedDate.ToShortDateString() tarihinde eklendi." width="50" height="50">
							</td>
							<td><a href="/IsEmri/IsEmriDosyaSil?IsEmriDosyaId=@dosya.IsEmriDosyaId" class="w3-btn w3-red"> Sil</a></td>
							<td><a href="@dosya.DosyaUrl" class="w3-btn w3-blue" download> Dosyayı İndir</a></td>
						</tr>
					}
				</tbody>

			</table>
		</div>
	</div>
</div>
<div id="modal01" class="w3-modal w3-animate-zoom" onclick="this.style.display='none'">
	<img class="w3-modal-content" id="viewImage">
</div>

<div id="ModalIscilikEkle" class="w3-modal">
	<div class="w3-modal-content">
		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('ModalIscilikEkle').style.display = 'none';location.reload();"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>İş Emri'ne İşçilik Ekle</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin" id="divIsEmriIscilikEkle">

			</div>
		</div>
		@*<footer class="w3-container w3-teal">
				<p>Modal Footer</p>
			</footer>*@
	</div>
</div>

<div id="ModalDyiEkle" class="w3-modal">
	<div class="w3-modal-content">
		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('ModalDyiEkle').style.display = 'none';location.reload();"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>İş Emri'ne Dış İşçilik Ekle</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin" id="divDyiEkle">

			</div>
		</div>

	</div>
</div>

<div id="ModelIsEmriAracTeslimLogGecmisi" class="w3-modal">
	<div class="w3-modal-content">
		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('ModelIsEmriAracTeslimLogGecmisi').style.display = 'none';"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>İş Emri Araç Teslim Geçmişi</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin" id="divModelIsEmriAracTeslimLogGecmisi">

			</div>
		</div>

	</div>
</div>


<div id="ModalParcaEkle" class="w3-modal">
	<div class="w3-modal-content">
		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('ModalParcaEkle').style.display = 'none';location.reload();"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>İş Emri'ne Parça Ekle</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin" id="divIsEmriParcaEkle">

			</div>
		</div>
	</div>
</div>


<div id="ModalPaketEkle" class="w3-modal">
	<div class="w3-modal-content">
		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('ModalPaketEkle').style.display='none'"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>İş Emri'ne Paket Ekle</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin" id="divIsEmriPaketEkle">

			</div>
		</div>
	</div>
</div>

<div id="ModalStokAl" class="w3-modal">
	<div class="w3-modal-content">
		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('ModalStokAl').style.display='none'"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>Konsinye Parçaları Stok'a Al</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin" id="divStokAl">

			</div>
		</div>
	</div>
</div>

<div id="ModalIskontoEkle" class="w3-modal">
	<div class="w3-modal-content">
		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('ModalIskontoEkle').style.display='none'"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>İş Emri'ne İskonto Ekle</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin" id="divIskontoEkle">
				@using (Html.BeginForm("IsEmriGenelIskontoUygula", "IsEmri", FormMethod.Post))
				{

					<input type="hidden" id="BelirtiKoduGenelIskonto" name="BelirtiKoduGenelIskonto" value="" />
					<input type="hidden" name="isEmriId" value="@Model.isEmri.IsEmriId" />
					<div class="w3-container">
						<div class="w3-third w3-padding">
							<label>Parça İndirim Oranı %</label>
							<input type="text" class="w3-input w3-border w3-round " name="parcaIskonto" />
						</div>
						<div class="w3-third w3-padding">
							<label>İşçilik İndirim Oranı %</label>
							<input type="text" class="w3-input w3-border w3-round " name="iscilikIskonto" />
						</div>
						<div class="w3-third w3-padding">
							<br />
							<button class="w3-btn w3-ripple w3-green w3-round" type="submit"><i class="fa fa-cart-arrow-down" aria-hidden="true"></i> İndirim Yap</button>
						</div>
					</div>
				}

			</div>
		</div>
	</div>
</div>

<div id="ModalKalemIskontoEkle" class="w3-modal">
	<div class="w3-modal-content">
		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('ModalKalemIskontoEkle').style.display='none'"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>Kalem'e İskonto Ekle</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin" id="divKalemeIskontoEkle">
				@using (Html.BeginForm("IsEmriKalemineIskontoUygula", "IsEmri", FormMethod.Post))
				{
					<input type="hidden" name="kalemIskontoIsEmriId" id="kalemIskontoIsEmriId" />
					<div class="w3-container">
						<div class="w3-third w3-padding">
							<label>İndirim Oranı %</label>
							<input type="text" class="w3-input w3-border w3-round" name="kalemIskontoOrani" />
						</div>
						<div class="w3-third w3-padding">
							<br />
							<button class="w3-btn w3-ripple w3-green w3-round" type="submit"><i class="fa fa-cart-arrow-down" aria-hidden="true"></i> İndirim Yap</button>
						</div>
					</div>
				}

			</div>
		</div>
	</div>
</div>

<div id="ModalIsEmriIptalEt" class="w3-modal">
	<div class="w3-modal-content">
		<header class="w3-container w3-red">
			<span onclick="document.getElementById('ModalIsEmriIptalEt').style.display='none'"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>İş Emri İptal Et</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin">
				@using (Html.BeginForm("IsEmriIptalEt", "IsEmri", FormMethod.Post))
				{
					<input type="hidden" name="IsEmriId" value="@Model.isEmri.IsEmriId" />
					<div class="w3-container">
						<div class="w3-row w3-padding">
							<label>İade iptal ?</label>
							<select id="IptalOnayIsEmriStatuId" name="IptalOnayIsEmriStatuId" class="w3-select w3-border w3-round" required="required">
								<option value="">İşçilik Emri Tipi Seçiniz</option>
								<option value="5">İade</option>
								<option value="6">İptal</option>
							</select>
						</div>
						<div class="w3-row w3-padding">
							<label>Açıklama ?</label>
							<textarea class="w3-input w3-border w3-round" maxlength="1024" autocomplete="off" name="isEmriIptalAciklamasi" required></textarea>
						</div>
						<div class="w3-row w3-padding">
							<br />
							<button class="w3-btn w3-ripple w3-green w3-round w3-right" type="submit"><i class="fa fa-times" aria-hidden="true"></i> İptal Et</button>
						</div>
					</div>
				}

			</div>
		</div>
	</div>
</div>


<div id="ModalIsEmriniFaturala" class="w3-modal">
	<div class="w3-modal-content">
		<header class="w3-container w3-green">
			<span onclick="document.getElementById('ModalIsEmriniFaturala').style.display='none'"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>İş Emri Fatura Talebi</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin" id="divMuhasebeyeGonder">
				@using (Html.BeginForm("IsEmriniMuhasebeyeGonder", "IsEmri", FormMethod.Post))
				{
					<input type="hidden" name="IsEmriId" value="@Model.isEmri.IsEmriId" />
					<div class="w3-container">
						<div class="w3-row w3-padding">
							<label>Faturalanacak Müşteri</label>
							@Html.DropDownList("FaturalanacakMusteriId", (SelectList)ViewBag.FaturalanacakMusteriler, htmlAttributes: new { @class = "w3-select w3-border w3-round", @Id = "FaturalanacakMusteriId" })
						</div>
						<div class="w3-row w3-padding">
							<label>Fatura Tipi</label>
							<div class=" w3-left w3-block w3-padding-right">
								<select class="w3-select" name="OrderFaturaTipi" id="OrderFaturaTipi" required>
									<option value="">Fatura Tipi Seçiniz</option>
									<option value="10">Normal Fatura</option>
									<option value="20">Açık Fatura  </option>
								</select>
							</div>
						</div>
						<div class="w3-row w3-padding">
							<label>Muhasebe Notu</label>
							<textarea class="w3-input w3-border w3-round" maxlength="1024" autocomplete="off" name="MuhasebeNotu" id="MuhasebeNotu"></textarea>
						</div>
						<div class="w3-row w3-padding">
							<br />
							<button class="w3-btn w3-ripple w3-green w3-round w3-right" type="submit"><i class="fa fa-files-o" aria-hidden="true"></i> Fatura İste</button>
						</div>
					</div>
				}
			</div>
			<div class="w3-row w3-margin" id="divBedelsizOnayGonder">
				@using (Html.BeginForm("IsEmriBedelsizOnayaGonder", "IsEmri", FormMethod.Post))
				{

					<input type="hidden" name="IsEmriIdBedelsiz" value="@Model.isEmri.IsEmriId" />
					<div class="w3-container">
						<div class="w3-panel w3-pale-yellow w3-border">
							<h3>Bilgilendirme!</h3>
							<p>İş emri içerisinde toplam tutar sıfırdır, iş emrini kapatabilmek için bedelsiz onaya göndermelisiniz.</p>
						</div>
						<div class="w3-row ">
							<label>Bedelsiz Onay Açıklaması</label>
							<textarea class="w3-input w3-border w3-round" maxlength="1024" autocomplete="off" name="BedelsizOnayAciklamasi" id="BedelsizOnayAciklamasi" required></textarea>
						</div>
					</div>
					<div class="w3-row ">
						<br />
						<button class="w3-btn w3-ripple w3-green w3-round w3-right" type="submit"><i class="fa fa-files-o" aria-hidden="true"></i> Bedelsiz Onaya Gönder</button>
					</div>
				}

			</div>
		</div>
	</div>
</div>

<div id="ModalParcaYonet" class="w3-modal">
	<div class="w3-modal-content-1200">
		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('ModalParcaYonet').style.display = 'none'; location.reload();"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>İş Emri'ne Parça Yönet</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin" id="divParcaYonet">

			</div>
		</div>
	</div>
</div>

<div id="ModalIsEmriTeslimAlanEdenKullaniciEkle" class="w3-modal">
	<div class="w3-modal-content">
		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('ModalIsEmriTeslimAlanEdenKullaniciEkle').style.display='none'"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>İş Emri'ne Müşteri Seç</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin" id="divIsEmriTeslimAlanEdenKullaniciEkle">

			</div>
		</div>
	</div>
</div>

<div id="ModalVehicleHistory" class="w3-modal">
	<div class="w3-modal-content w3-animate-top" style="width:80%">
		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('ModalVehicleHistory').style.display = 'none';"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>Araç Geçmişi</h2>
		</header>
		<div class="w3-container">
			<div class="w3-row w3-margin" id="divVehicleHistory">

			</div>
		</div>

	</div>
</div>

<div id="modalFatura" class="w3-modal">
	<div class="w3-modal-content">

		<header class="w3-container w3-teal">
			<span onclick="document.getElementById('modalFatura').style.display = 'none';location.reload();"
				  class="w3-button w3-display-topright">&times;</span>
			<h2>Fatura Kes</h2>
		</header>

		<div class="w3-container">
			@*@using (Html.BeginForm("FaturaKes", "Invoice", FormMethod.Post))*@
			@using (Ajax.BeginForm("FaturaKes", "Invoice", new AjaxOptions { HttpMethod = "POST", OnSuccess = "OnSuccess", OnFailure = "OnFailure" }))
			{
				@Html.AntiForgeryToken()
				@Html.Hidden("mdlFaturaId")
				@Html.Hidden("mdlIsEmriId")
				@Html.Hidden("mdlIsEmriTipi")
				@Html.Hidden("FaturaTipi")
				<div>
					<div class="w3-row w3-padding">
						<div class="w3-padding w3-large fontDuzgun w3-center" id="FaturaMessage">

						</div>
					</div>
					<div class="w3-row w3-padding w3-hide" id="fisMessage">
						<span>Fiş numarası sistem tarafından fiş oluştur dedikten sonra oluşur</span>
					</div>
					<div class="w3-row w3-padding">
						<div class="w3-threequarter" id="divFaturaNo">
							<label id="lblFaturaFisNumarasi">Fatura Numarası</label>
							<input class="w3-input w3-border uppercase" rows="6" cols="300" name="faturaNumarasi" id="mdlFaturaNo" />
						</div>
						<div class="w3-quarter">
							<br />
							<button class="w3-btn w3-ripple w3-teal w3-right w3-block w3-border" id="btnFaturaFisOlustur">Fatura Oluştur</button>
						</div>
					</div>
				</div>
			}

		</div>

	</div>
</div>


<script type="text/javascript">
	function OnSuccess(data) {

		$('#mdlFaturaNo').attr("disabled", "disabled");
		$('#btnFaturaFisOlustur').attr("disabled", "disabled");

		if (data.result == true) {
			toastr.success(data.message, "İşlem Başarılı");

			$('#mdlFaturaNo').val(data.FaturaNo);

		}
		else {
			toastr.error(data.message, "İşlem Başarısız!");
		}

	}
	function OnFailure(data) {

		alert(data.result);

		alert(data.message);
	}
</script>